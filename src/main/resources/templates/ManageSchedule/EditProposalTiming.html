<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Dashboard </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/CSS/sidebar-admin.css">
  <link rel="stylesheet" href="/CSS/EditScheduleTiming.css">

  <!-- Library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
<div class="container">
  <!-- Slide bar-->
  <div class="sidebar">
    <h2>ICT MAHIDOL</h2>
    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
        <path
                d="M39.5,43h-9c-1.381,0-2.5-1.119-2.5-2.5v-9c0-1.105-0.895-2-2-2h-4c-1.105,0-2,0.895-2,2v9c0,1.381-1.119,2.5-2.5,2.5h-9	C7.119,43,6,41.881,6,40.5V21.413c0-2.299,1.054-4.471,2.859-5.893L23.071,4.321c0.545-0.428,1.313-0.428,1.857,0L39.142,15.52	C40.947,16.942,42,19.113,42,21.411V40.5C42,41.881,40.881,43,39.5,43z">
        </path>
      </svg> Homepage </h4>
      <li><a href="/admin-dashboard">Dashboard</a></li>
      <li><a href="/admin-proposal-report">Proposal Grade Report</a></li>
      <li><a href="/admin-defense-report">Defense Grade Report</a></li>
      <li><a href="/admin-eva-traking">Evaluation Tracking</a></li>
    </ul>

    <h2> Pages </h2>

    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">
        <g fill="#ffffff" fill-rule="nonzero">
          <g transform="scale(5.33333,5.33333)">
            <path
                    d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">
            </path>
          </g>
        </g>
      </svg>Score Evaluation </h4>
      <li><a href="#">Scoring Period Settings</a></li>
    </ul>

    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
        <path
                d="M42 15v-2.5C42 8.916 39.084 6 35.5 6h-23C8.916 6 6 8.916 6 12.5V15H42zM25.5 27H32V33H25.5zM35 27H42V33H35zM6 27H13V33H6zM16 27H22.5V33H16zM35 18H42V24H35zM25.5 18H32V24H25.5zM25.5 36H32V42H25.5zM16 36H22.5V42H16zM35 36v6h.5c3.415 0 6.218-2.649 6.475-6H35zM6.025 36c.257 3.351 3.059 6 6.475 6H13v-6H6.025zM16 18H22.5V24H16zM6 18H13V24H6z">
        </path>
      </svg> Manage Schedule </h4>
      <li><a href="/admin/proposalSchedule">Proposal Schedule</a></li>
      <li><a href="#"  class="active">Edit Proposal Timing</a></li>
      <li><a href="#">Defense Schedule</a></li>
      <li><a href="#">Edit Defense Timing</a></li>
    </ul>

    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
        <path
                d="M35.5,8h-3.551C31.697,5.756,29.81,4,27.5,4h-7c-2.31,0-4.197,1.756-4.449,4H12.5C10.019,8,8,10.019,8,12.5v27	c0,2.481,2.019,4.5,4.5,4.5h23c2.481,0,4.5-2.019,4.5-4.5v-27C40,10.019,37.981,8,35.5,8z M20.5,7h7C28.327,7,29,7.673,29,8.5	S28.327,10,27.5,10h-7C19.673,10,19,9.327,19,8.5S19.673,7,20.5,7z M22.5,34h-8c-0.828,0-1.5-0.671-1.5-1.5s0.672-1.5,1.5-1.5h8	c0.828,0,1.5,0.671,1.5,1.5S23.328,34,22.5,34z M22.5,24h-8c-0.828,0-1.5-0.671-1.5-1.5s0.672-1.5,1.5-1.5h8	c0.828,0,1.5,0.671,1.5,1.5S23.328,24,22.5,24z M34.561,34.439c0.586,0.585,0.586,1.536,0,2.121C34.268,36.854,33.884,37,33.5,37	s-0.768-0.146-1.061-0.439L31,35.121l-1.439,1.439C29.268,36.854,28.884,37,28.5,37s-0.768-0.146-1.061-0.439	c-0.586-0.585-0.586-1.536,0-2.121L28.879,33l-1.439-1.439c-0.586-0.585-0.586-1.536,0-2.121c0.586-0.586,1.535-0.586,2.121,0	L31,30.879l1.439-1.439c0.586-0.586,1.535-0.586,2.121,0c0.586,0.585,0.586,1.536,0,2.121L33.121,33L34.561,34.439z M34.561,21.561	l-4,4C30.268,25.854,29.884,26,29.5,26s-0.768-0.146-1.061-0.439l-2-2c-0.586-0.585-0.586-1.536,0-2.121	c0.586-0.586,1.535-0.586,2.121,0l0.939,0.939l2.939-2.939c0.586-0.586,1.535-0.586,2.121,0	C35.146,20.025,35.146,20.975,34.561,21.561z">
        </path>
      </svg> Manage Project </h4>
      <li><a href="#">Project Overview</a></li>
      <li><a href="#">Project Details</a></li>
      <li><a href="#">Committee</a></li>
      <li><a href="#">Poster Committee</a></li>
    </ul>
  </div>

  <div class="content">

    <div class="header-section">
      Edit Proposal Timing
<!--      <div class="btn-header">-->
<!--        <button class="template-btn">Template</button>-->
<!--        <button class="upload-btn">Upload Files</button>-->
<!--        <button class="addProject-btn">+ Add Projects</button>-->
<!--      </div>-->
    </div>

    <div class="body-section">

      <div class="table-container">
        <div class="filter-controls">
          <button class="filter active" onclick="filterProjects('all')">All</button>
          <button class="filter" onclick="filterProjects('ict')">ICT</button>
          <button class="filter" onclick="filterProjects('dst')">DST</button>
          <input type="text" id="searchInput" placeholder="Search">

        </div>
        <table>
          <thead>
          <tr>
            <th class="left-align">Project ID</th>
            <th class="left-align">Project Name</th>
            <th class="left-align">Instructor</th>
            <th>Date</th>
            <th>Time</th>
            <th>Room</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody id="projectTable">

<!--          <tr data-category="ict">-->
<!--            <td><span class="tag ict">ICT</span> SP2024-01 </td>-->
<!--            <td>A Noise-Resilient Model</td>-->
<!--            <td>-->
<!--              <div class="instructor-container">-->
<!--                <div class="instructor-group">-->
<!--                  <div>-->
<!--                    <span class="advisor-label">Advisor</span>-->
<!--                    <span class="instructor-name">Aj.Akara</span>-->
<!--                  </div>-->
<!--                </div>-->
<!--                <div class="instructor-group">-->
<!--                  <div class="instructor-name">Aj.XXX, Aj.YYY</div>-->
<!--                  <div class="instructor-type">Co-Instructor</div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </td>-->
<!--            <td>2025-03-06</td>-->
<!--            <td>13:00 - 14:00</td>-->
<!--            <td>IT103</td>-->
<!--            <td>-->
<!--              <button class="edit-btn" onclick="showProjectDetails('project1')">Edit</button>-->
<!--            </td>-->
<!--          </tr>-->

<!--          <tr data-category="dst">-->
<!--            <td><span class="tag dst">DST</span> SP2024-02 </td>-->
<!--            <td>IoT Dashboard</td>-->
<!--            <td>-->
<!--              <div class="instructor-container">-->
<!--                <div class="instructor-group">-->
<!--                  <div>-->
<!--                    <span class="advisor-label">Advisor</span>-->
<!--                    <span class="instructor-name">Aj.Akara</span>-->
<!--                  </div>-->
<!--                </div>-->
<!--                  <div class="instructor-name">Aj.Sudsanguan, Aj.Thanaporn</div>-->
<!--                  <div class="instructor-type">Co-Instructor</div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </td>-->
<!--            <td>2025-03-013</td>-->
<!--              <td>13:00 - 14:00</td>-->
<!--              <td>IT202</td>-->
<!--            <td>-->
<!--              <button class="edit-btn" onclick="showProjectDetails('project1')">Edit</button>-->
<!--            </td>-->
<!--          </tr>-->

          </tbody>
        </table>
      </div>
    </div>


    <div class="card-popup">
            <div class="card-header">
                <h1 class="card-title">DST SP2024-04</h1>
                <div class="tag ict">ICT</div>
            </div>

            <div class="project-info">
                <p><strong>Project Title : </strong> Project Management Tools (ProjectESS)</p>
            </div>

            <div class="students-section">
                <h2 class="section-title">Instructor</h2>

                <div class="student-card">
                    <div class="student-name">Tunyarat Nithirunpattana</div>
                    <div class="student-details">Advisor</div>
                </div>

                <div class="student-card">
                    <div class="student-name">Chanyanuch Nuangjumnong</div>
                    <div class="student-details">Committee</div>
                </div>

                <div class="student-card">
                    <div class="student-name">Neadnapa Thawontaweekul</div>
                    <div class="student-details">Committee</div>
                </div>
            </div>


            <div class="modal-footer">
                <button id="saveBtn">Save</button>
                <button id="cancelBtn">Cancel</button>
            </div>

        </div>

    <div class="btn-footer">
      <button class="deleteAll-btn">Delete ALL</button>
    </div>


  </div>
</div>
</body>

</html>

<script>

  document.addEventListener("DOMContentLoaded", function () {
    const menuItems = document.querySelectorAll(".sidebar ul li a");

    // ‡∏î‡∏∂‡∏á URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    const currentPage = window.location.pathname.split("/").pop();

    menuItems.forEach(item => {
      if (item.getAttribute("href") === currentPage) {
        item.classList.add("active"); // ‡πÄ‡∏û‡∏¥‡πà‡∏° class "active" ‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      }
    });
  });

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
  function filterProjects(category) {
    const rows = document.querySelectorAll("#projectTable tr");
    rows.forEach(row => {
      if (category === "all") {
        row.style.display = "";
      } else {
        row.style.display = row.getAttribute("data-category") === category ? "" : "none";
      }
    });

    document.querySelectorAll(".filter").forEach(btn => btn.classList.remove("active"));
    document.querySelector(`.filter[onclick="filterProjects('${category}')"]`).classList.add("active");
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
  function searchProjects() {
    const searchValue = document.getElementById("searchInput").value.toLowerCase();
    const rows = document.querySelectorAll("#projectTable tr");

    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      row.style.display = text.includes(searchValue) ? "" : "none";
    });
  }

  document.getElementById("searchInput").addEventListener("input", searchProjects);

  // ============================================================= Get all project edit =====================================================================

  document.addEventListener('DOMContentLoaded', function () {
    console.log("üöÄ Load Page");
    getProjectEditProposal();
  });

  function getProjectEditProposal() {

    fetch(`http://localhost:8080/admin/getProjectEditProposal`, {

      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    })
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
                alert('Network response was not ok ' + response.statusText);
              }
              return response.json();
            })
            .then(data => {
              console.log("üêçdata: ", data);

              if(data.length === 0) {
                console.log("No data available");

              } else {
                // console.log("Data found: ", data);

                const tbody = document.getElementById("projectTable");

                data.forEach(project => {

                  const row = document.createElement("tr");
                  row.setAttribute("data-category", project.program.toLowerCase());

                  let advisor = "";
                  let committee = "";

                  if(typeof project.instructorNames === "object") {

                    advisor = project.instructorNames.Advisor ? {name: project.instructorNames.Advisor[0] }: null;
                    committee = project.instructorNames.Committee || [];
                  }

                  let projectId = project.projectId;
                  let cleanId = projectId.replace(/DST|ICT/g, '').trim();

                  let timeSlot = "";
                  let FormattedDate = "";
                  if (project.startTime && project.endTime != null) {
                  // JavaScript Date object
                      const startTime = new Date(project.startTime);
                      const endTime = new Date(project.endTime);
                      timeSlot = `${startTime.getHours()}:${String(startTime.getMinutes()).padStart(2, '0')} - ${endTime.getHours()}:${String(endTime.getMinutes()).padStart(2, '0')}`;
                      console.log("üï∞Ô∏è timeSlot: ", timeSlot);
                      console.log("startTime: ", startTime);
                      console.log("endTime: ", endTime);

                      const getDate = new Date(project.date);
                      let nameDay = getDate.toLocaleDateString('en-us', {weekday: 'short'})
                      let month = getDate.toLocaleDateString('en-us', {month: 'short'})
                      let date = getDate.toLocaleDateString('en-us', {day: 'numeric'})
                      let year = getDate.toLocaleDateString('en-us', {year: 'numeric'})

                      // FormattedDate = `${nameDay} ${month} ${date}, ${year}`
                      FormattedDate = `${nameDay}, ${date} ${month}. ${year}`
                      console.log("üóìÔ∏è getDate: ", getDate);
                      console.log("FormattedDate: ", FormattedDate);
                  }


                    row.innerHTML = `
                    <td class="left-align">${cleanId} <br><span class="tag ${project.program.toLowerCase()}">${project.program}</span></td>
                    <td class="left-align">${project.projectTitle}</td>
                    <td>
                      <div class="instructor-container">
                      ${advisor
                          ?`
                            <div class="instructor-group">
                              <div>
                                <span class="advisor-label">Advisor</span>
                                <span class="instructor-name">${advisor.name}</span>
                              </div>
                            </div>

                            `
                          : ''}

                        ${committee.length > 0
                          ?`
                            <div class="instructor-group">
                                <div class="instructor-name">${committee.join(", ")}</div>
                                <div class="instructor-type">Committee</div>
                              </div>
                            </div>
                       `
                          : ''}
                    </td>
                    <td class="${!FormattedDate? 'empty-date' : ''}">${FormattedDate ? FormattedDate: ''}</td>
                    <td class="${!timeSlot ? 'empty-time' : ''}" data-placeholder="Add Time">${timeSlot ? timeSlot: ''}</td>
                    <td class="${!project.room ? 'empty-room' : ''}">${project.room ? project.room: ''}</td>
                    <td>
                      <button class="edit-btn" data-id="${projectId}">Edit</button>
                    </td>
                  `;
                  tbody.appendChild(row);
                });

              }
            })
            .catch(error => {
              console.error('Error fetching data:', error);

              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
              });
            });
  }

  // ============================================================= Modal =====================================================================

  document.addEventListener('DOMContentLoaded', function () {

      document.querySelector('tbody').addEventListener('click', function (e) {

          if(e.target.classList.contains("edit-btn")) {

              const projectId = e.target.getAttribute("data-id");
              console.log("üìå Open modal");

              document.querySelector(".card-popup").style.display = "block";
          }
      });

      document.getElementById("cancelBtn").addEventListener("click", function () {
          document.querySelector(".card-popup").style.display = "none";
      });

  });


  window.onclick = function(event) {
      const modal = document.querySelector(".card-popup");

      if (modal && !modal.contains(event.target) && !event.target.classList.contains("edit-btn")) {
          console.log("‚õî ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Modal -> ‡∏õ‡∏¥‡∏î Modal");
          document.querySelector(".card-popup").style.display = "none";
      }

  };





</script>