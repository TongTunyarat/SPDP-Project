<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Dashboard </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/css/sidebar-admin.css">
  <link rel="stylesheet" href="/css/ScheduleStyle.css">

  <!-- Library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>

<body>

    <!-- Slide bar-->
    <div class="sidebar">
      <h2>ICT MAHIDOL</h2>
      <ul>
        <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
          <path
                  d="M39.5,43h-9c-1.381,0-2.5-1.119-2.5-2.5v-9c0-1.105-0.895-2-2-2h-4c-1.105,0-2,0.895-2,2v9c0,1.381-1.119,2.5-2.5,2.5h-9	C7.119,43,6,41.881,6,40.5V21.413c0-2.299,1.054-4.471,2.859-5.893L23.071,4.321c0.545-0.428,1.313-0.428,1.857,0L39.142,15.52	C40.947,16.942,42,19.113,42,21.411V40.5C42,41.881,40.881,43,39.5,43z">
          </path>
        </svg> Homepage </h4>
        <li><a href="/admin-dashboard">Dashboard</a></li>
        <li><a href="/admin-proposal-report">Proposal Grade Report</a></li>
        <li><a href="/admin-defense-report">Defense Grade Report</a></li>
        <li><a href="/admin-eva-traking">Evaluation Tracking</a></li>
      </ul>

      <h2> Pages </h2>

      <ul>
        <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">
          <g fill="#ffffff" fill-rule="nonzero">
            <g transform="scale(5.33333,5.33333)">
              <path
                      d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">
              </path>
            </g>
          </g>
        </svg>Score Evaluation </h4>
        <li><a href="#">Scoring Period Settings</a></li>
      </ul>

      <ul>
        <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
          <path
                  d="M42 15v-2.5C42 8.916 39.084 6 35.5 6h-23C8.916 6 6 8.916 6 12.5V15H42zM25.5 27H32V33H25.5zM35 27H42V33H35zM6 27H13V33H6zM16 27H22.5V33H16zM35 18H42V24H35zM25.5 18H32V24H25.5zM25.5 36H32V42H25.5zM16 36H22.5V42H16zM35 36v6h.5c3.415 0 6.218-2.649 6.475-6H35zM6.025 36c.257 3.351 3.059 6 6.475 6H13v-6H6.025zM16 18H22.5V24H16zM6 18H13V24H6z">
          </path>
        </svg> Manage Schedule </h4>
        <li><a href="/admin/proposalSchedule"  class="active">Proposal Schedule</a></li>
        <li><a href="/admin/editProposalSchedulePage">Edit Proposal Timing</a></li>
        <li><a href="#">Defense Schedule</a></li>
        <li><a href="#">Edit Defense Timing</a></li>
      </ul>

      <ul>
        <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
          <path
                  d="M35.5,8h-3.551C31.697,5.756,29.81,4,27.5,4h-7c-2.31,0-4.197,1.756-4.449,4H12.5C10.019,8,8,10.019,8,12.5v27	c0,2.481,2.019,4.5,4.5,4.5h23c2.481,0,4.5-2.019,4.5-4.5v-27C40,10.019,37.981,8,35.5,8z M20.5,7h7C28.327,7,29,7.673,29,8.5	S28.327,10,27.5,10h-7C19.673,10,19,9.327,19,8.5S19.673,7,20.5,7z M22.5,34h-8c-0.828,0-1.5-0.671-1.5-1.5s0.672-1.5,1.5-1.5h8	c0.828,0,1.5,0.671,1.5,1.5S23.328,34,22.5,34z M22.5,24h-8c-0.828,0-1.5-0.671-1.5-1.5s0.672-1.5,1.5-1.5h8	c0.828,0,1.5,0.671,1.5,1.5S23.328,24,22.5,24z M34.561,34.439c0.586,0.585,0.586,1.536,0,2.121C34.268,36.854,33.884,37,33.5,37	s-0.768-0.146-1.061-0.439L31,35.121l-1.439,1.439C29.268,36.854,28.884,37,28.5,37s-0.768-0.146-1.061-0.439	c-0.586-0.585-0.586-1.536,0-2.121L28.879,33l-1.439-1.439c-0.586-0.585-0.586-1.536,0-2.121c0.586-0.586,1.535-0.586,2.121,0	L31,30.879l1.439-1.439c0.586-0.586,1.535-0.586,2.121,0c0.586,0.585,0.586,1.536,0,2.121L33.121,33L34.561,34.439z M34.561,21.561	l-4,4C30.268,25.854,29.884,26,29.5,26s-0.768-0.146-1.061-0.439l-2-2c-0.586-0.585-0.586-1.536,0-2.121	c0.586-0.586,1.535-0.586,2.121,0l0.939,0.939l2.939-2.939c0.586-0.586,1.535-0.586,2.121,0	C35.146,20.025,35.146,20.975,34.561,21.561z">
          </path>
        </svg> Manage Project </h4>
        <li><a href="#">Project Overview</a></li>
        <li><a href="#">Project Details</a></li>
        <li><a href="#">Committee</a></li>
        <li><a href="#">Poster Committee</a></li>
      </ul>
    </div>


    <div class="content">
      <div class="header-section">
        <div class="title-group">
          Manage Proposal Schedule

          <div class="program-selector" id="program-selector">
            <i class="far fa-calendar"></i>
            <span class="selected-program" id="program-text">DST</span>
            <i class="fas fa-chevron-down dropdown-arrow"></i>

            <div class="dropdown-options" id="dropdown-options">
              <div class="dropdown-option" data-value="DST">DST</div>
              <div class="dropdown-option" data-value="ICT">ICT</div>
            </div>

          </div>
        </div>
        <button class="set-btn" id="openModal">Setting</button>
      </div>

      <!-- ===================================================================  Modal =================================================================== -->
      <div class="modal" id="settingModal">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Setting</h4>
          </div>

          <div class="modal-body">
            <input type="hidden" id="csrfToken" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
<!--            <p>CSRF Token: <span th:text="${_csrf.token}">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤</span></p>-->
            <label>Start Date:</label>
            <input type="date" class="custom-input" id="start-date"/><br>

            <label>End Date:</label>
            <input type="date" class="custom-input" id="end-date"/><br>

            <label>Time Start :</label>
            <input type="time" class="custom-input"><br>

            <label>End Start :</label>
            <input type="time" class="custom-input"><br>

            <label>Room: </label>
            <div class="dropdown">

              <button id="selected-label" onclick="toggleDropdown()">
                <span id="selected-text">Select Room</span>
              </button>

              <div class="dropdown-content upward" id="dropdown-content">
                  <input type="text" id="search" placeholder="Search" onkeyup="filterRooms()">
                  <label><input type="checkbox" id="select-all" onclick="selectAll()"> Select All</label><br>
                  <div id="room-list"></div>
              </div>
            </div><br>

            <div class="modal-footer">
              <button id="saveBtn">Save</button>
              <button id="cancelBtn">Cancel</button>
            </div>
          </div>

<!--          https://codepen.io/AdamDipinto/pen/ewKxwE-->
          <div class="modal-loader-overlay" id="modalLoaderOverlay" style="display:none;">
            <div class="loader-center">
              <div class="loader">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>

        </div>
      </div>

<!--      ===================================================================  Schedule =================================================================== */-->
      <div class="schedule"></div>
      <div class="button-container">
        <button class="preview-block">Preview</button>
        <button class="export-block">Export</button>
      </div>
    </div>


</body>

</html>

<!-- ===================================================================  Modal =================================================================== -->

<script>

    function fetchData() {
        let url = 'http://localhost:8080/admin/roomSetting';

        fetch(url)
                .then(response => {
                  // console.log(response.json());
                  if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                  }
                  return response.json();
                })
                .then(data => {
                  // console.log("üêç Data Length: " + data.length);
                  // console.log("Show Data: " + JSON.stringify(data, null, 2));

                  rooms.length = 0;

                  data.forEach(function(room) {
                    rooms.push(room);
                  });

                  createRooms();

                })
                .catch(error => {
                  console.error('Error fetching data:', error);
                  document.getElementById('filter-results').innerHTML = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á";
                });
      }

    document.addEventListener('DOMContentLoaded', function () {
      console.log("üöÄ Load Page");
        getScheduleData();
        fetchData();
    });


    // open modal
    document.getElementById("openModal").addEventListener("click", function() {
      console.log("üìå Open modal");
      document.getElementById("settingModal").style.display = "block";
    });

    // close modal
    function closeModal() {
      console.log("‚ùå Close Modal");
      document.getElementById("settingModal").style.display = "none";

      document.querySelectorAll("input[type='date']").forEach(input => {
        input.value = "";
        input.removeAttribute("min");
        input.removeAttribute("max");
      });

      document.querySelector("input[type='time']").value = "";
      document.querySelectorAll("input[type='time']")[1].value = "";

      document.getElementById("selected-text").textContent = "Select Room";
      selectedRooms.clear();
      const checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
      checkboxes.forEach(cb => {

        cb.checked = false;

      });

      let selectAllCheckbox = document.getElementById("select-all");

      if(selectAllCheckbox) {

        selectAllCheckbox.checked = false;

      }
    }

    document.getElementById("cancelBtn").addEventListener("click", closeModal);


    // click out modal
    // https://stackoverflow.com/questions/45393553/window-onclick-functionevent-only-works-for-first-item
    window.onclick = function(event) {
      let modal = document.getElementById("settingModal");

      if (event.target === modal) {
        // console.log("üëÄ Event: " + event.target);
        // console.dir(event.target);
        // console.log("üôÇ Modal: " + modal);
        // console.dir(modal);
        console.log("‚õî ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Modal -> ‡∏õ‡∏¥‡∏î Modal");
        closeModal();
      }

    };

    // date (https://stackoverflow.com/questions/20491326/start-and-end-date-validation-in-html5)
    const startDate = document.querySelector("#start-date");
    const endDate = document.querySelector("#end-date");

    startDate.addEventListener('change', function () {

      if (startDate.value) {
        endDate.min = startDate.value
      }

    }, false);

    endDate.addEventListener('change', function () {

      if (endDate.value) {
        startDate.max = endDate.value
      }

    }, false);

    // https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_onblur (blur)
    endDate.addEventListener('blur', function () {

      if (endDate.value && startDate.value && endDate.value < startDate.value) {
        Swal.fire({
          icon: "error",
          title: "Sorry!",
          text: "End date cannot be earlier than the Start date.",
          draggable: true,
          confirmButtonColor: "#dc3360"
        });

        endDate.value = "";
        endDate.min = "";
      }

    });

    startDate.addEventListener('blur', function () {

      if (startDate.value && endDate.value && startDate.value > endDate.value) {
        Swal.fire({
          icon: "error",
          title: "Sorry!",
          text: "Start date cannot be more than End date",
          draggable: true,
          confirmButtonColor: "#dc3360"
        });

        startDate.value = "";
        startDate.max = "";
      }

    });


    // room
    const rooms = [];
    let selectedRooms = new Set();

    function toggleDropdown() {
      let dropdown = document.getElementById("dropdown-content");
      let isVisible = dropdown.style.display === "block";
      console.log(`${isVisible}`);

      dropdown.style.display = isVisible ? "none" : "block";
      console.log(`üìÇ Dropdown ${isVisible ? "close" : "open"}`);
    }

    function filterRooms() {
      // change
      let searchValue = document.getElementById("search").value.toLowerCase();
      console.log(`üîé Find: ${searchValue}`);

      let filteredRooms = rooms.filter(room => room.toLowerCase().includes(searchValue));
      console.log("üìã Result:", filteredRooms);

      createRooms(filteredRooms); // ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    }

    function createRooms(filteredRooms = rooms) {
      let roomList = document.getElementById("room-list");
      roomList.innerHTML = ""; // clear

      console.log("üîÑ Load new room");
      console.log("üîç Room:", filteredRooms);

      filteredRooms.forEach(room => {
        let label = document.createElement("label");
        label.classList.add("room-label");
        let checkbox = document.createElement("input");

        checkbox.type = "checkbox";
        checkbox.value = room;
        checkbox.checked = selectedRooms.has(room);

        checkbox.onchange = function () {
          if (checkbox.checked) {
            selectedRooms.add(room);
            console.log(`‚úÖ Select room: ${room}`);
          } else {
            selectedRooms.delete(room);
            console.log(`‚ùå Delete room: ${room}`);
          }
          updateSelectedCount();
        };

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(` ${room}`));
        roomList.appendChild(label);
        roomList.appendChild(document.createElement("br"));
      });

      updateSelectedCount();
    }

    function selectAll() {
      let selectAllCheckbox = document.getElementById("select-all");
      let checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
      let isChecked = selectAllCheckbox.checked;

      console.log(isChecked ? "üîò Select all" : "‚≠ï Cancle all");

      checkboxes.forEach(cb => {
        cb.checked = isChecked;

        if (isChecked) {
          selectedRooms.add(cb.value);
        } else {
          selectedRooms.delete(cb.value);
        }

      });

      updateSelectedCount();
    }

    function updateSelectedCount() {
      let count = selectedRooms.size;

        if (count > 0) {
          document.getElementById("selected-text").textContent = `${count} Selected`;
        } else {
          document.getElementById("selected-text").textContent = "Select Room";
        }

      console.log(`üìä Count room: ${count}`);
      console.log("üìã List room:", [...selectedRooms]);
    }

    // close dropdown room
    document.addEventListener("click", function(event) {

      if (!event.target.closest(".dropdown")) {
        document.getElementById("dropdown-content").style.display = "none";
        // console.log("üìå ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å -> ‡∏õ‡∏¥‡∏î Dropdown");
      }

    });

    <!-- ===================================================================  Generate =================================================================== -->


    function getCsrfToken() {

      let tokenInput = document.getElementById("csrfToken");

      if (tokenInput && tokenInput.value) {
        return tokenInput.value;
      }

      console.error("‚õî CSRF token not found.");
      return "dummy-token";
    }



    // send value to controlller
    document.getElementById("saveBtn").addEventListener("click", function () {
      let startDateInput = document.querySelector("input[type='date']");
      let endDateInput = document.querySelectorAll("input[type='date']")[1];
      let startTimeInput = document.querySelector("input[type='time']");
      let endTimeInput = document.querySelectorAll("input[type='time']")[1];
      let program = document.getElementById("program-text").textContent;

      // console.log("startDateInput:", startDateInput);
      // console.log("endDateInput:", endDateInput);
      // console.log("startTimeInput:", startTimeInput);
      // console.log("endTimeInput:", endTimeInput);
      // console.log("program:", program);


      let startDate = startDateInput.value;
      let endDate = endDateInput.value;
      let startTime = startTimeInput.value;
      let endTime = endTimeInput.value;
      let selectedRoom = [...selectedRooms];
      let programData = program;

      if (!startDate || !endDate || !startTime || !endTime || selectedRoom.length === 0) {
        Swal.fire({
          icon: "warning",
          title: "Oops...",
          text: "Please fill in all information.",
          draggable: true,
          confirmButtonColor: "#dc7633"
        });
        return;
      }

      let csrfToken = getCsrfToken();
      console.log("üëÄ CSRF Token: ", csrfToken);

      if (!csrfToken || csrfToken === "dummy-token") {
        alert("CSRF Token Invalid‚ùóÔ∏è");
        return;
      }

      //check exits
      fetch(`http://localhost:8080/admin/checkExitsSchedule?program=${encodeURIComponent(programData)}`, {

        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })
              .then(response => response.json())
              .then(data => {

                const exists = data.checkEexti;
                console.log("Schedule exists:", exists);

                if (exists) {

                  Swal.fire({
                    icon: "warning",
                    title: "Existing Schedules Found",
                    text: "Projects from this program already have proposal schedules. Please delete existing schedules first.",
                    showConfirmButton: true,
                    confirmButtonColor: "#3085d6",
                    confirmButtonText: "Delete",
                    showCancelButton: true,
                    cancelButtonText: "Cancel",
                    cancelButtonColor: "#d33"
                  }) .then((result) => {

                    if (result.isConfirmed) {
                      deleteAllSchedule();
                    }

                  });
                } else {
                  saveScheduleData();
                }
              })
              .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Error checking existing schedules!",
                });
              });

      function deleteAllSchedule() {

        fetch(`http://localhost:8080/admin/deleteAllExitsSchedule?program=${encodeURIComponent(programData)}`, {

          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        })

           .then(response => response.json())
           .then(data => {
             const statusDeleteAll = data.deleteStatus;
             console.log("Schedule success delete:", statusDeleteAll);

             if (statusDeleteAll) {
               const schedule = document.querySelector(".schedule");
               const table = document.querySelector("table");
               schedule.innerHTML = "";

               Swal.fire({
                 icon: "success",
                 title: "Delete successfully.",
                 showConfirmButton: false,
                 timer: 2000
               });
             }
           })
           .catch(error => {
                console.error('Error:', error);
                Swal.fire({
               icon: "error",
               title: "Oops...",
               text: "Failed to delete schedules!",
           });
        });
      }

      function saveScheduleData() {
        let settingData = {
          startDate: startDate,
          endDate: endDate,
          startTime: startTime,
          endTime: endTime,
          rooms: selectedRoom,
          program: programData
        };

        console.log("üì§ settingData: ", settingData);

        document.getElementById("modalLoaderOverlay").style.display = "flex";

        fetch('http://localhost:8080/admin/bookingSave', {

          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': csrfToken
          },
          body: JSON.stringify(settingData)

        })
                .then(response =>
                        response.json()
                )
                .then(data => {

                  console.log('üåº Data:', data);

                  if (data.status === "error") {

                    document.getElementById("modalLoaderOverlay").style.display = "none";

                    Swal.fire({
                      icon: "error",
                      title: "Error",
                      text: data.message,
                      showConfirmButton: false,
                      showCancelButton: true,
                      cancelButtonText: "Cancel",
                      cancelButtonColor: "#d33"
                    });
                  } else {
                    const projectId = data.scheduledAssignments[0]?.projectId;
                    console.log('üåæ projectId: ', projectId);

                    // ====================================== call list date =====================================
                    const getDate = getScheduleDate(data);
                    // console.log("üóìÔ∏è List of Date: " +  getScheduleDate(data));

                    const getDateFormat = formatDate(getDate).sort((a, b) => new Date(a) - new Date(b));
                    console.log("üóìÔ∏è List of Date: " +  formatDate(getDate));

                    const schedule = document.querySelector(".schedule");
                    schedule.innerHTML = ""

                    const backgroundSchedule = document.createElement("div");
                    backgroundSchedule.className = "background-schedule";

                    const scheduleContainer = document.createElement("div");
                    scheduleContainer.className = "schedule-contanier";

                    const scheduleHeader = document.createElement("div");
                    scheduleHeader.className = "shedule-header";

                    const prevButton = document.createElement("button");
                    prevButton.className = "nav-button pre-button";
                    prevButton.textContent = "‚ùÆ";

                    const dateTitle = document.createElement("h2");
                    dateTitle.className = "date-title";

                    const nextButton = document.createElement("button");
                    nextButton.className = "nav-button next-button";
                    nextButton.textContent = "‚ùØ";

                    scheduleHeader.appendChild(prevButton);
                    scheduleHeader.appendChild(dateTitle);
                    scheduleHeader.appendChild(nextButton);

                    backgroundSchedule.appendChild(scheduleHeader);

                    // ====================================== room =====================================

                    const scheduleTable = document.createElement("div");
                    scheduleTable.className = "schedule-table";

                    const table = document.createElement("table");
                    const thead = document.createElement("thead");
                    const rowHeader = document.createElement("tr");
                    const timeHeader = document.createElement("th");

                    timeHeader.textContent = "Time";
                    timeHeader.className = "time-column";
                    rowHeader.appendChild(timeHeader);

                    const rooms = [...new Set(data.scheduledAssignments.map(proj => proj.roomNumber))];
                    console.log("‚òÑÔ∏è Room: "+rooms);

                    rooms.forEach(room => {
                      const th = document.createElement("th");
                      th.textContent = room;
                      console.log("room: "+room);
                      rowHeader.appendChild(th);
                    });

                    thead.appendChild(rowHeader);
                    table.appendChild(thead);

                    let tableBody = document.createElement("tbody");

                    let currentDateIndex = 0;

                    function updateScheduleDisplay() {

                      if (getDateFormat.length === 0) return;

                      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å list
                      const currentDate = getDateFormat[currentDateIndex];
                      dateTitle.textContent = currentDate;

                      prevButton.disabled = currentDateIndex === 0;
                      nextButton.disabled = currentDateIndex === getDateFormat.length - 1;

                      tableBody.innerHTML = "";

                      console.log("currentDate: "+currentDate);

                      // select pj ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                      const assignProjectDay = data.scheduledAssignments.filter(project => {

                        const projectDate = new Date(project.startTime).toLocaleDateString();
                        const currentDateObj = new Date(Date.parse(currentDate));
                        const selectDate = currentDateObj.toLocaleDateString();
                        console.log("currentDateObj: "+currentDateObj);
                        console.log("selectDate: "+selectDate);
                        return projectDate === selectDate;
                      });

                      console.log("assignProjectDay: "+assignProjectDay);

                      // list ‡∏Ç‡∏≠‡∏á time, room, project
                      const timeSlots = {};

                      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô schedule
                      assignProjectDay.forEach(project => {

                        const startTime = new Date(project.startTime);
                        const endTime = new Date(project.endTime);

                        const timeSlot = `${startTime.getHours()}:${String(startTime.getMinutes()).padStart(2, '0')} - ${endTime.getHours()}:${String(endTime.getMinutes()).padStart(2, '0')}`;
                        console.log("üï∞Ô∏ètimeSlot: "+timeSlot);

                        if (!timeSlots[timeSlot]) {
                          timeSlots[timeSlot] = {
                            isBreak: false,
                            breakLabel: "",
                            project: {}
                          };
                          console.log("creat time slots: "+ timeSlots);
                        }

                        timeSlots[timeSlot][project.roomNumber] = project;
                        console.log("time slots: " + JSON.stringify(timeSlots, null, 2));
                      });

                      // ‡πÄ‡∏≠‡∏≤ allTimeSlots ‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ break
                      if(data.allTimeSlots) {

                        data.allTimeSlots.forEach(timeSlotDTO => {

                          console.log("üìåtimeSlotDTO: " + timeSlotDTO);

                          const startTime = new Date(timeSlotDTO.startTime);
                          const endTime = new Date(timeSlotDTO.endTime);

                          const timeSlot = `${startTime.getHours()}:${String(startTime.getMinutes()).padStart(2, '0')} - ${endTime.getHours()}:${String(endTime.getMinutes()).padStart(2, '0')}`;

                          if (!timeSlots[timeSlot]) {
                            timeSlots[timeSlot] = {
                              isBreak: false,
                              breakLabel: "",
                              project: {}
                            };
                          }

                          timeSlots[timeSlot].isBreak = timeSlotDTO.break;
                          timeSlots[timeSlot].breakLabel = timeSlotDTO.breakLabel;

                        })
                      }

                      // sort time
                      const sortTimeSlots =  Object.keys(timeSlots).sort((a, b) => {

                        console.log("üôä Check sort time: "+a + " AND "+ b);

                        const [hoursA, minutesA] = a.split(' - ')[0].split(':').map(Number);
                        console.log([hoursA, minutesA]);
                        const [hoursB, minutesB] = b.split(' - ')[0].split(':').map(Number);
                        console.log([hoursB, minutesB]);


                        const totalMinutesA = hoursA * 60 + minutesA;
                        const totalMinutesB = hoursB * 60 + minutesB;
                        console.log("totalMinutesA: "+ totalMinutesA);
                        console.log("totalMinutesB: "+ totalMinutesB);

                        return totalMinutesA - totalMinutesB;
                      })

                      console.log("sortTimeSlots: " + sortTimeSlots);

                      sortTimeSlots.forEach(timeSlot => {
                        const slotInfo = timeSlots[timeSlot];

                        // console.log("slotInfo: " + slotInfo);

                        if(slotInfo.isBreak) {

                          console.log("‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤ Break ");

                          const breakRow = document.createElement("tr");
                          breakRow.className = "break-row";

                          const breakCell = document.createElement("td");
                          breakCell.colSpan = rooms.length + 1;
                          // breakCell.className = "break-slot";
                          breakCell.textContent = `${slotInfo.breakLabel} (${timeSlot})`

                          breakRow.appendChild(breakCell);
                          tableBody.appendChild(breakRow);
                        } else {

                          console.log("üëÄüëÄtimeSlot: " + timeSlot);

                          const row = document.createElement("tr");

                          // ‡∏Ñ‡∏≠‡∏• timeslot ‡∏Å‡πà‡∏≠‡∏ô
                          const timeCell = document.createElement("td");
                          timeCell.className = "time-slot";
                          timeCell.textContent = timeSlot;
                          row.appendChild(timeCell);

                          rooms.forEach(room => {
                            console.log("room: " + room);

                            const cell = document.createElement("td");
                            const project = timeSlots[timeSlot][room];
                            console.log("project: " + project);

                            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ project ‡πÉ‡∏ô timeSlot ‡∏ó‡∏µ‡πà loop
                            if (project) {

                              const instructorUsernames = project.instructorUsernames;

                              cell.innerHTML = `

                                <div class="slot-box ${project.status === "Non-Active" ? "non-active" : ''}"><br><div class="project-id">${project.projectId}</div><br><div class="instructors"></div>
<!--                                  <svg id="icon-edit" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">-->
<!--                                    <path d="M16.4612 1.53747C15.2966 0.372875 13.4084 0.372933 12.2439 1.5376L2.28549 11.4971C1.94688 11.8358 1.70888 12.2617 1.59797 12.7276L0.684976 16.5621C0.634709 16.7733 0.697568 16.9954 0.851034 17.1489C1.00451 17.3023 1.22661 17.3652 1.43774 17.3149L5.27212 16.402C5.73812 16.291 6.16418 16.0529 6.50289 15.7141L14.8342 7.38187C15.3994 7.95171 15.398 8.87187 14.8299 9.43996L13.3437 10.9261C13.0996 11.1702 13.0996 11.5659 13.3437 11.81C13.5878 12.054 13.9835 12.054 14.2276 11.81L15.7138 10.3238C16.77 9.26762 16.7715 7.55596 15.7181 6.49793L16.4613 5.75457C17.6257 4.59 17.6257 2.70198 16.4612 1.53747ZM13.1278 2.42143C13.8041 1.74497 14.9009 1.74493 15.5773 2.42136C16.2536 3.09772 16.2537 4.19432 15.5774 4.87074L5.61896 14.8303C5.44383 15.0055 5.22353 15.1285 4.98259 15.186L2.13623 15.8636L2.81398 13.0171C2.87132 12.7763 2.99437 12.556 3.16943 12.381L13.1278 2.42143Z" fill="#878D96"/>-->
<!--                                 </svg>-->
                                   <div class="icon-delete ${project.status === "Non-Active" ? "hidden" : ''}">
                                        <input type="hidden" id="hiddenInfo" name="projectId" value="${project.projectId}">
                                       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M5.20833 2.5C3.71256 2.5 2.5 3.71257 2.5 5.20833V14.7917C2.5 16.2874 3.71257 17.5 5.20833 17.5H14.7917C16.2874 17.5 17.5 16.2874 17.5 14.7917V5.20833C17.5 3.71256 16.2874 2.5 14.7917 2.5H5.20833ZM6.84973 6.84973C7.0938 6.60565 7.48953 6.60565 7.73361 6.84973L10 9.11608L12.2664 6.84973C12.5105 6.60565 12.9062 6.60565 13.1502 6.84973C13.3943 7.0938 13.3943 7.48953 13.1502 7.73361L10.8839 10L13.1502 12.2664C13.3943 12.5105 13.3943 12.9062 13.1502 13.1502C12.9062 13.3943 12.5105 13.3943 12.2664 13.1502L10 10.8839L7.73361 13.1502C7.48953 13.3943 7.0938 13.3943 6.84973 13.1502C6.60565 12.9062 6.60565 12.5105 6.84973 12.2664L9.11608 10L6.84973 7.73361C6.60565 7.48953 6.60565 7.0938 6.84973 6.84973Z" fill="currentColor"/>
                                       </svg>
                                   </div>
                               </div>
                                `;

                              let instructorList = '';

                              if(instructorUsernames) {
                                 instructorList = instructorUsernames.map(name => `${name}`).join(', ');
                              } else {
                                instructorList = 'No instructors available';
                              }

                              const instructorDiv = cell.querySelector(".instructors");
                              instructorDiv.innerHTML = instructorList;
                            }
                            row.appendChild(cell);
                          });
                          tableBody.appendChild(row);
                        }
                      });

                      table.appendChild(tableBody);
                      scheduleTable.appendChild(table);
                      backgroundSchedule.appendChild(scheduleTable);
                      schedule.appendChild(backgroundSchedule);

                      document.getElementById("modalLoaderOverlay").style.display = "none";
                    }

                    updateScheduleDisplay();

                    prevButton.addEventListener("click", () => {

                      if(currentDateIndex > 0) {
                        currentDateIndex --;
                        updateScheduleDisplay();
                      }

                    })

                    nextButton.addEventListener("click", () => {

                      if(currentDateIndex < getDateFormat.length -1 ) {
                        currentDateIndex ++;
                        updateScheduleDisplay();
                      }
                    })

                    Swal.fire({
                      icon: "success",
                      title: "Data saved successfully.",
                      showConfirmButton: false,
                      timer: 2000
                    });

                    document.getElementById("settingModal").style.display = "none";

                    // document.querySelector("input[type='date']").value = "";
                    // document.querySelector("input[type='date']").removeAttribute("min");
                    // document.querySelector("input[type='date']").removeAttribute("max");

                    // document.querySelectorAll("input[type='date']")[1].value = "";
                    // document.querySelector("input[type='date']")[1].removeAttribute("min");
                    // document.querySelector("input[type='date']")[1].removeAttribute("max");

                    document.querySelectorAll("input[type='date']").forEach(input => {

                      input.value = "";
                      input.removeAttribute("min");
                      input.removeAttribute("max");

                    });

                    document.querySelector("input[type='time']").value = "";
                    document.querySelectorAll("input[type='time']")[1].value = "";

                    document.getElementById("selected-text").textContent = "Select Room";
                    selectedRooms.clear();

                    const checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
                    checkboxes.forEach(cb => {

                      cb.checked = false;

                    });

                    let selectAllCheckbox = document.getElementById("select-all");

                    if(selectAllCheckbox) {

                      selectAllCheckbox.checked = false;

                    }

                  }

                }).catch(error => {

                  console.error('Error:', error);
                  document.getElementById("modalLoaderOverlay").style.display = "none";
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Something went wrong!",
                  });
        });
      }

    });

    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    function getScheduleDate(data) {

      const dateSet = new Set();

      data.scheduledAssignments.forEach(project => {

        if(project.startTime) {

          const dateString = project.startTime.split("T")[0];

          dateSet.add(dateString);
        }
      });

      const sortDate = Array.from(dateSet).sort();

      //https://www.w3schools.com/js/js_date_formats.asp
      return sortDate.map(dateStr => new Date(dateStr))
    }

    // change format
    function formatDate(formatDate) {

      const collectDate = [];

      formatDate.forEach(getDay => {

        const dateObj = new Date(getDay);

        //https://stackoverflow.com/questions/3552461/how-do-i-format-a-date-in-javascript/60881661
        let nameDay = dateObj.toLocaleDateString('en-us', {weekday: 'long'})
        let month = dateObj.toLocaleDateString('en-us', {month: 'long'})
        let date = dateObj.toLocaleDateString('en-us', {day: 'numeric'})
        let year = dateObj.toLocaleDateString('en-us', {year: 'numeric'})

        const FormattedDate = `${nameDay}, ${month} ${date}, ${year}`

        collectDate.push(FormattedDate);

      });

      return collectDate;
    }


    <!-- ===================================================================  Get Schedule =================================================================== -->

    function getScheduleData() {
      let program = document.getElementById("program-text").textContent;

      fetch(`http://localhost:8080/admin/getAllProposalSchedule?program=${encodeURIComponent(program)}`, {

        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(response => {
          // console.log(response.json());
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
            alert('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
                .then(data => {
                  // console.log("Show Data: " + JSON.stringify(data, null, 2));

                  if(JSON.stringify(data) === "{}") {

                    const schedule = document.querySelector(".schedule");
                    schedule.innerHTML = "";

                    const backgroundSchedule = document.createElement("div");
                    backgroundSchedule.className = "background-schedule";

                    const emptyScheduleImage = document.createElement("img");
                    emptyScheduleImage.className = "empty-state-image";
                    emptyScheduleImage.src = "/css/warning_schedule-Photoroom.png"

                    backgroundSchedule.appendChild(emptyScheduleImage);

                    schedule.appendChild(backgroundSchedule);
                  } else {

                    let rooms = new Set();
                    let dates = new Set();

                    for(const date in data) {
                      const timeSlots =  data[date];
                      dates.add(date);

                      for(const timeSlot in timeSlots) {
                        const  project = timeSlots[timeSlot];

                        for(const i of project) {
                          rooms.add(i.roomNumber);
                        }
                      }
                    }

                    rooms.delete("noRoom")

                    console.log("‚≠êÔ∏è Room: " + Array.from(rooms));

                    let myRooms = [];

                    //https://www.geeksforgeeks.org/how-to-sort-a-set-in-javascript/
                    myRooms = Array.from(rooms)
                    myRooms.sort()
                    console.log("Room sort: " + myRooms);

                    myDate = Array.from(dates)
                    myDate.sort()
                    console.log("Room sort: " + myDate);

                    // ====================================== call list date =====================================

                    const getDateFormat = formatDate(myDate).sort((a, b) => new Date(a) - new Date(b));
                    console.log("üóìÔ∏è List of Date: " +  getDateFormat);

                    const schedule = document.querySelector(".schedule");
                    schedule.innerHTML = ""

                    const backgroundSchedule = document.createElement("div");
                    backgroundSchedule.className = "background-schedule";

                    const scheduleContainer = document.createElement("div");
                    scheduleContainer.className = "schedule-contanier";

                    const scheduleHeader = document.createElement("div");
                    scheduleHeader.className = "shedule-header";

                    const prevButton = document.createElement("button");
                    prevButton.className = "nav-button pre-button";
                    prevButton.textContent = "‚ùÆ";

                    const dateTitle = document.createElement("h2");
                    dateTitle.className = "date-title";

                    const nextButton = document.createElement("button");
                    nextButton.className = "nav-button next-button";
                    nextButton.textContent = "‚ùØ";

                    scheduleHeader.appendChild(prevButton);
                    scheduleHeader.appendChild(dateTitle);
                    scheduleHeader.appendChild(nextButton);

                    backgroundSchedule.appendChild(scheduleHeader);

                    // ====================================== room =====================================

                     const scheduleTable = document.createElement("div");
                    scheduleTable.className = "schedule-table";

                    const table = document.createElement("table");
                    const thead = document.createElement("thead");
                    const rowHeader = document.createElement("tr");
                    const timeHeader = document.createElement("th");

                    timeHeader.textContent = "Time";
                    timeHeader.className = "time-column";
                    rowHeader.appendChild(timeHeader);

                    myRooms.forEach(room => {
                      const th = document.createElement("th");
                      th.textContent = room;
                      console.log("-_- room: "+room);
                      rowHeader.appendChild(th);
                    });

                    thead.appendChild(rowHeader);
                    table.appendChild(thead);

                    let tableBody = document.createElement("tbody");

                    let currentDateIndex = 0;

                    function updateScheduleDisplay() {

                      if (getDateFormat.length === 0) return;

                      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å list
                      const currentDate = getDateFormat[currentDateIndex];
                      dateTitle.textContent = currentDate;

                      prevButton.disabled = currentDateIndex === 0;
                      nextButton.disabled = currentDateIndex === getDateFormat.length - 1;

                      tableBody.innerHTML = "";

                      console.log("currentDate: " + currentDate);

                      const currentDateObj = new Date(currentDate);
                      console.log("currentDateObj: " + currentDateObj);

                      const currentDateStr = currentDateObj.toLocaleDateString("en-CA");
                      console.log("currentDateStr: " + currentDateStr);

                      // select pj ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà  [ "2025-03-06", { "(13:00, 13:25)": [ {...} ] } ],
                      const assignProjectDay = Object.entries(data).filter(([dateKey]) => dateKey === currentDateStr)
                              .flatMap(([dateKey, timeSlots]) =>
                                      Object.entries(timeSlots).map(([timeKey, projects]) => ({
                                        [timeKey]: projects.map(project => ({ ...project }))
                                      }))
                              );

                      // console.log("assignProjectDay: "+assignProjectDay);

                      // for(const project of assignProjectDay) {
                      //   console.log("project: ",project);
                      // }

                      if (assignProjectDay.length === 0) {
                        const noDataRow = document.createElement("tr");
                        const noDataCell = document.createElement("td");
                        noDataCell.colSpan = myRooms.length + 1; // +1 for time slot column
                        noDataCell.textContent = "No schedule available for this date";
                        noDataCell.style.textAlign = "center";
                        noDataCell.style.padding = "20px";
                        noDataRow.appendChild(noDataCell);
                        tableBody.appendChild(noDataRow);
                      } else {

                        // list ‡∏Ç‡∏≠‡∏á time, room, project
                        const timeSlotMap = {};
                        assignProjectDay.forEach(projectObj => {
                          // console.log("ü§Ø Loop");

                          const timeSlotKey = Object.keys(projectObj)[0];
                          // console.log("timeSlotKey: ",timeSlotKey);
                          const projects = projectObj[timeSlotKey];
                          // console.log("projects: ",projects);

                          // create time
                          if(!timeSlotMap[timeSlotKey]) {
                            timeSlotMap[timeSlotKey] = {};
                          }

                          projects.forEach(project => {
                            if(project.roomNumber) {
                              timeSlotMap[timeSlotKey][project.roomNumber] = project;
                              console.log("time slots: " + JSON.stringify(timeSlotMap, null, 2));
                            }
                          });
                        });

                        Object.keys(timeSlotMap).forEach(timeSlot => {
                          console.log("üëÄüëÄtimeSlot: " + timeSlot);

                          const isBreakTimeSlot = Object.values(timeSlotMap[timeSlot]).some(
                                  project => project && project.status === "Break"
                          );

                          if (isBreakTimeSlot) {
                            const breakRow = document.createElement("tr");
                            breakRow.className = "break-row";

                            const breakCell = document.createElement("td");
                            breakCell.colSpan = myRooms.length + 1;
                            breakCell.className = "break-slot";

                            const match = timeSlot.match(/\((\d{2}:\d{2}), (\d{2}:\d{2})\)/);
                            const startTime = match[1];
                            const endTime = match[2];

                            breakCell.textContent = `Take a Break (${startTime} - ${endTime})`;

                            breakRow.appendChild(breakCell);
                            tableBody.appendChild(breakRow);
                          } else {

                          const row = document.createElement("tr");

                            const match = timeSlot.match(/\((\d{2}:\d{2}), (\d{2}:\d{2})\)/);
                            const startTime = match[1];
                            const endTime = match[2];

                          // ‡∏Ñ‡∏≠‡∏• timeslot ‡∏Å‡πà‡∏≠‡∏ô
                          const timeCell = document.createElement("td");
                          timeCell.className = "time-slot";
                          timeCell.textContent = `${startTime} - ${endTime}`;
                          row.appendChild(timeCell);

                          myRooms.forEach(room => {

                            console.log("room: " + room);

                            const cell = document.createElement("td");
                            const project = timeSlotMap[timeSlot][room];
                            console.log("project: " + project);

                            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ project ‡πÉ‡∏ô timeSlot ‡∏ó‡∏µ‡πà loop
                            if (project) {

                              const instructorUsernames = project.instructors;

                              cell.innerHTML = `

                                <div class="slot-box ${project.status === "Non-Active" ? "non-active" : ''}"><br><div class="project-id">${project.projectId}</div><br><div class="instructors"></div>
<!--                                  <svg id="icon-edit" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">-->
<!--                                    <path d="M16.4612 1.53747C15.2966 0.372875 13.4084 0.372933 12.2439 1.5376L2.28549 11.4971C1.94688 11.8358 1.70888 12.2617 1.59797 12.7276L0.684976 16.5621C0.634709 16.7733 0.697568 16.9954 0.851034 17.1489C1.00451 17.3023 1.22661 17.3652 1.43774 17.3149L5.27212 16.402C5.73812 16.291 6.16418 16.0529 6.50289 15.7141L14.8342 7.38187C15.3994 7.95171 15.398 8.87187 14.8299 9.43996L13.3437 10.9261C13.0996 11.1702 13.0996 11.5659 13.3437 11.81C13.5878 12.054 13.9835 12.054 14.2276 11.81L15.7138 10.3238C16.77 9.26762 16.7715 7.55596 15.7181 6.49793L16.4613 5.75457C17.6257 4.59 17.6257 2.70198 16.4612 1.53747ZM13.1278 2.42143C13.8041 1.74497 14.9009 1.74493 15.5773 2.42136C16.2536 3.09772 16.2537 4.19432 15.5774 4.87074L5.61896 14.8303C5.44383 15.0055 5.22353 15.1285 4.98259 15.186L2.13623 15.8636L2.81398 13.0171C2.87132 12.7763 2.99437 12.556 3.16943 12.381L13.1278 2.42143Z" fill="#878D96"/>-->
<!--                                 </svg>-->
                                   <div class="icon-delete ${project.status === "Non-Active" ? "hidden" : ''}">
                                        <input type="hidden" id="hiddenInfo" name="projectId" value="${project.projectId}">
                                       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M5.20833 2.5C3.71256 2.5 2.5 3.71257 2.5 5.20833V14.7917C2.5 16.2874 3.71257 17.5 5.20833 17.5H14.7917C16.2874 17.5 17.5 16.2874 17.5 14.7917V5.20833C17.5 3.71256 16.2874 2.5 14.7917 2.5H5.20833ZM6.84973 6.84973C7.0938 6.60565 7.48953 6.60565 7.73361 6.84973L10 9.11608L12.2664 6.84973C12.5105 6.60565 12.9062 6.60565 13.1502 6.84973C13.3943 7.0938 13.3943 7.48953 13.1502 7.73361L10.8839 10L13.1502 12.2664C13.3943 12.5105 13.3943 12.9062 13.1502 13.1502C12.9062 13.3943 12.5105 13.3943 12.2664 13.1502L10 10.8839L7.73361 13.1502C7.48953 13.3943 7.0938 13.3943 6.84973 13.1502C6.60565 12.9062 6.60565 12.5105 6.84973 12.2664L9.11608 10L6.84973 7.73361C6.60565 7.48953 6.60565 7.0938 6.84973 6.84973Z" fill="currentColor"/>
                                       </svg>
                                   </div>
                               </div>
                                `;

                              let instructorList = '';

                              if(instructorUsernames) {
                                instructorList = instructorUsernames.map(name => `${name}`).join(', ');
                              } else {
                                instructorList = 'No instructors available';
                              }

                              const instructorDiv = cell.querySelector(".instructors");
                              instructorDiv.innerHTML = instructorList;
                            }

                            row.appendChild(cell);
                          });

                          tableBody.appendChild(row);}
                        });
                      }
                      table.appendChild(tableBody);
                      scheduleTable.appendChild(table);
                      backgroundSchedule.appendChild(scheduleTable);
                      schedule.appendChild(backgroundSchedule);
                    }

                    updateScheduleDisplay();

                    prevButton.addEventListener("click", () => {

                      if(currentDateIndex > 0) {
                        currentDateIndex --;
                        updateScheduleDisplay();
                      }

                    })

                    nextButton.addEventListener("click", () => {

                      if(currentDateIndex < getDateFormat.length -1 ) {
                        currentDateIndex ++;
                        updateScheduleDisplay();
                      }
                    })

                  }
                })
                .catch(error => {
                  console.error('Error fetching data:', error);

                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Something went wrong!",
                  });
                });

    }


    // toggle program

    const selector = document.getElementById('program-selector');
    const selectedProgram = document.getElementById('program-text');
    const dropdownOptions = document.getElementById('dropdown-options');
    const options = document.querySelectorAll('.dropdown-option');

    selector.addEventListener('click', () => {

      let isVisible = dropdownOptions.style.display === "block";

      dropdownOptions.style.display = isVisible ? "none" : "block";

      selector.classList.toggle('active');
    })

    options.forEach(option => {

      option.addEventListener('click', (e) => {
        e.stopPropagation();

        const newValue = option.dataset.value;

        selectedProgram.textContent = newValue;

        selector.classList.remove('active');
        dropdownOptions.style.display = "none";

        getScheduleData()

        console.log('Selected program:', newValue);

      });
    });

    document.addEventListener('click', (e) => {
      if(!selector.contains(e.target)) {

        selector.classList.remove('active');
        dropdownOptions.style.display = "none";
      }
    })

    // ====================================== click delete =====================================

    document.addEventListener('click', (e) => {
      const deleteButton = e.target.closest('.icon-delete');

      if(deleteButton) {

        const slotBox = deleteButton.closest('.slot-box');
        const id = slotBox.querySelector('#hiddenInfo');
        console.log("‚ùóÔ∏èDo you want to delete project id " + id.value);

        Swal.fire({
          icon: "warning",
          title: "Are you sure ?",
          text: "Delete the schedule for project: " + id.value,
          showConfirmButton: true,
          confirmButtonColor: "#3085d6",
          confirmButtonText: "Delete",
          showCancelButton: true,
          cancelButtonText: "Cancel",
          cancelButtonColor: "#d33"
        }).then((result) => {

          if (result.isConfirmed) {
            deleteScheduleProject(id.value)
          }
        })

      }
    })

    function deleteScheduleProject(projectId) {

      fetch(`http://localhost:8080/admin/deleteProjectById?projectId=${encodeURIComponent(projectId)}`, {

        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
              .then(response => {
                // console.log(response.json());
                if (!response.ok) {
                  throw new Error('Network response was not ok ' + response.statusText);
                  alert('Network response was not ok ' + response.statusText);
                }
                return response.json();
              })
              .then(data => {
                console.log("Deleted Project Status:", data);
                const statusDeleteProject = data.deleteProjectByIdStatus;
                console.log("deleteProjectByIdStatus:", statusDeleteProject);


                if (statusDeleteProject) {

                  Swal.fire({
                    icon: "success",
                    title: "Delete schedule project successfully.",
                    showConfirmButton: false,
                    timer: 2000
                  });

                  getScheduleData();

                }
              })
              .catch(error => {
                console.error('Error fetching data:', error);

                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Something went wrong!",
                });
              });
    }



</script>