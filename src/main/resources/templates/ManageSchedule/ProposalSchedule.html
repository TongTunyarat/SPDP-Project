<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Proposal Schedule </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/css/sidebar-admin.css">
  <link rel="stylesheet" href="/css/ScheduleStyle.css">

  <!-- Library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</head>

<body>

<!-- Slide bar-->
<div class="sidebar">
  <h2>ICT MAHIDOL</h2>

  <form th:action="@{/logout}" method="post" class="logout-container">
    <!--        à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¹‰à¸­à¸‡à¸à¸±à¸™ Cross-Site Request Forgery (CSRF)-->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    <button type="submit" class="logout-button"><i class="fas fa-sign-out-alt"></i></button>
  </form>

  <ul>
    <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
      <path
              d="M39.5,43h-9c-1.381,0-2.5-1.119-2.5-2.5v-9c0-1.105-0.895-2-2-2h-4c-1.105,0-2,0.895-2,2v9c0,1.381-1.119,2.5-2.5,2.5h-9	C7.119,43,6,41.881,6,40.5V21.413c0-2.299,1.054-4.471,2.859-5.893L23.071,4.321c0.545-0.428,1.313-0.428,1.857,0L39.142,15.52	C40.947,16.942,42,19.113,42,21.411V40.5C42,41.881,40.881,43,39.5,43z">
      </path>
    </svg> Homepage </h4>
    <li><a href="/admin-dashboard">Dashboard</a></li>
    <li><a href="/admin-proposal-report">Proposal Grade Report</a></li>
    <li><a href="/admin-defense-report">Defense Grade Report</a></li>
    <li><a href="/admin-eva-traking">Evaluation Tracking</a></li>
    <li><a href="/admin-timeliness-scoring">Timeliness Scoring</a></li>
  </ul>

  <h2> Pages </h2>

  <ul>
    <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">
      <g fill="#ffffff" fill-rule="nonzero">
        <g transform="scale(5.33333,5.33333)">
          <path
                  d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">
          </path>
        </g>
      </g>
    </svg>Score Evaluation </h4>
    <li><a href="/scoring-periods">Scoring Period Settings</a></li>
  </ul>

  <ul>
    <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
      <path
              d="M42 15v-2.5C42 8.916 39.084 6 35.5 6h-23C8.916 6 6 8.916 6 12.5V15H42zM25.5 27H32V33H25.5zM35 27H42V33H35zM6 27H13V33H6zM16 27H22.5V33H16zM35 18H42V24H35zM25.5 18H32V24H25.5zM25.5 36H32V42H25.5zM16 36H22.5V42H16zM35 36v6h.5c3.415 0 6.218-2.649 6.475-6H35zM6.025 36c.257 3.351 3.059 6 6.475 6H13v-6H6.025zM16 18H22.5V24H16zM6 18H13V24H6z">
      </path>
    </svg> Manage Schedule </h4>
    <li><a href="/admin/proposalSchedule" class="active">Proposal Schedule</a></li>
    <li><a href="/admin/editProposalSchedulePage">Edit Proposal Timing</a></li>
    <li><a href="/admin/defenseSchedule">Defense Schedule</a></li>
    <li><a href="/admin/editDefenseSchedulePage">Edit Defense Timing</a></li>
  </ul>

  <ul>
    <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="fill:#FFFFFF;">
      <path
              d="M35.5,8h-3.551C31.697,5.756,29.81,4,27.5,4h-7c-2.31,0-4.197,1.756-4.449,4H12.5C10.019,8,8,10.019,8,12.5v27	c0,2.481,2.019,4.5,4.5,4.5h23c2.481,0,4.5-2.019,4.5-4.5v-27C40,10.019,37.981,8,35.5,8z M20.5,7h7C28.327,7,29,7.673,29,8.5	S28.327,10,27.5,10h-7C19.673,10,19,9.327,19,8.5S19.673,7,20.5,7z M22.5,34h-8c-0.828,0-1.5-0.671-1.5-1.5s0.672-1.5,1.5-1.5h8	c0.828,0,1.5,0.671,1.5,1.5S23.328,34,22.5,34z M22.5,24h-8c-0.828,0-1.5-0.671-1.5-1.5s0.672-1.5,1.5-1.5h8	c0.828,0,1.5,0.671,1.5,1.5S23.328,24,22.5,24z M34.561,34.439c0.586,0.585,0.586,1.536,0,2.121C34.268,36.854,33.884,37,33.5,37	s-0.768-0.146-1.061-0.439L31,35.121l-1.439,1.439C29.268,36.854,28.884,37,28.5,37s-0.768-0.146-1.061-0.439	c-0.586-0.585-0.586-1.536,0-2.121L28.879,33l-1.439-1.439c-0.586-0.585-0.586-1.536,0-2.121c0.586-0.586,1.535-0.586,2.121,0	L31,30.879l1.439-1.439c0.586-0.586,1.535-0.586,2.121,0c0.586,0.585,0.586,1.536,0,2.121L33.121,33L34.561,34.439z M34.561,21.561	l-4,4C30.268,25.854,29.884,26,29.5,26s-0.768-0.146-1.061-0.439l-2-2c-0.586-0.585-0.586-1.536,0-2.121	c0.586-0.586,1.535-0.586,2.121,0l0.939,0.939l2.939-2.939c0.586-0.586,1.535-0.586,2.121,0	C35.146,20.025,35.146,20.975,34.561,21.561z">
      </path>
    </svg> Manage Project </h4>
    <li><a href="/project-overview">Project Overview</a></li>
    <li><a href="/project-details">Project Details</a></li>
    <li><a href="/project-committee">Committee</a></li>
    <li><a href="/project-poster-committee">Poster Committee</a></li>
  </ul>
</div>



<div class="content">
  <div class="header-section">
    <div class="title-group">
      Manage Proposal Schedule

      <div class="program-selector" id="program-selector">
        <i class="far fa-calendar"></i>
        <span class="selected-program" id="program-text">DST</span>
        <i class="fas fa-chevron-down dropdown-arrow"></i>

        <div class="dropdown-options" id="dropdown-options">
          <div class="dropdown-option" data-value="DST">DST</div>
          <div class="dropdown-option" data-value="ICT">ICT</div>
        </div>

      </div>
    </div>

    <div class="semester-container">
      <select id="semester-selector" onchange="getScheduleData(); getUnScheduleData();"></select>
    </div>

    <button class="set-btn" id="openModal">Setting</button>
  </div>

  <!-- ===================================================================  Modal =================================================================== -->
  <div class="modal" id="settingModal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Setting</h4>
      </div>

      <div class="modal-body">
        <input type="hidden" id="csrfToken" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <!--            <p>CSRF Token: <span th:text="${_csrf.token}">à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸²</span></p>-->
        <label>Start Date:</label>
        <input type="date" class="custom-input" id="start-date"/><br>

        <label>End Date:</label>
        <input type="date" class="custom-input" id="end-date"/><br>

        <label>Time Start :</label>
        <input type="time" class="custom-input"><br>

        <label>Time End :</label>
        <input type="time" class="custom-input"><br>

        <label>Room: </label>
        <div class="dropdown">

          <button id="selected-label" onclick="toggleDropdown()">
            <span id="selected-text">Select Room </span>
            <i class="fa fa-caret-down"></i>
          </button>

          <div class="dropdown-content upward" id="dropdown-content">

            <div class="dropdown-header">
              <div id="back-button" onclick="backToFloors()">
                <span style="font-size: 20px">&larr;</span>
              </div>
              <h4 id="floor-title">Select Floor</h4>
            </div>

            <div id="search-container">
              <input type="text" id="search" placeholder="Search room" onkeyup="filterRooms()">
            </div>

            <div id="select-all-container">
              <label><input type="checkbox" id="select-all" onclick="selectAll()"> Select All</label><br>
            </div>

            <div id="room-list"></div>

          </div>
        </div><br>

        <div class="modal-footer">
          <button id="saveBtn">Save</button>
          <button id="cancelBtn">Cancel</button>
        </div>
      </div>

    </div>
  </div>


  <!--          https://codepen.io/AdamDipinto/pen/ewKxwE-->
  <div class="modal-loader-overlay" id="modalLoaderOverlay" style="display:none;">
    <div class="loader-center">
      <div class="loader">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>


  <!--      ===================================================================  Schedule =================================================================== */-->
  <div class="schedule"></div>


  <div class="container">
    <!--        <div class="unscheduled-projects">-->
    <!--          <div class="header">-->
    <!--            <i class="fa-solid fa-calendar-xmark"></i>-->
    <!--            Unscheduled Projects-->
    <!--          </div>-->

    <!--          <div class="warning-header">-->
    <!--            <i class="fa-solid fa-triangle-exclamation warning-icon"></i>-->
    <!--            <div class="warning-text">The following projects could not be scheduled due to insufficient rooms or time slots.</div>-->
    <!--          </div>-->

    <!--          <div class="projects-list">-->
    <!--            &lt;!&ndash; Project 1 &ndash;&gt;-->
    <!--            <div class="project-item">-->
    <!--              <div class="project-header">-->
    <!--                <div class="project-id-new">SP2023-22</div>-->
    <!--                <div class="tag-container">-->
    <!--                  <span class="tag tag-proposal">Proposal</span>-->
    <!--                  <span class="tag tag-ict">ICT</span>-->
    <!--                </div>-->
    <!--              </div>-->

    <!--              <div class="project-title">Smart Traffic Management System using IoT and Machine Learning</div>-->

    <!--              <div class="instructor-section">-->
    <!--                <div class="instructor-label">Instructors:</div>-->
    <!--                <div class="instructors-list">-->
    <!--                  <div class="instructor-chip">-->
    <!--                    <i class="fa-solid fa-user"></i>-->
    <!--                    Aj.Pavitra-->
    <!--                  </div>-->
    <!--                  <div class="instructor-chip">-->
    <!--                    <i class="fa-solid fa-user"></i>-->
    <!--                    Aj.Thilima-->
    <!--                  </div>-->
    <!--                  <div class="instructor-chip">-->
    <!--                    <i class="fa-solid fa-user"></i>-->
    <!--                    Aj.Akara-->
    <!--                  </div>-->
    <!--                </div>-->
    <!--              </div>-->
    <!--            </div>-->
    <!--          </div>-->
    <!--        </div>-->
  </div>


  <div class="button-container">
    <button class="preview-block" onclick="openPreview()">Preview</button>
    <script>
      //https://www.w3schools.com/jsref/met_win_open.asp
      function openPreview(){
        window.open('/admin/previewProposalSchedulePage', '_blank');
      }
    </script>
    <!--        <button class="export-block">Export</button>-->

    <!--        <script>-->

    <!--          document.querySelector(".export-block").addEventListener("click", function() {-->

    <!--            let program = document.getElementById("program-text").textContent.trim();-->

    <!--            document.getElementById("modalLoaderOverlay").style.display = "flex";-->
    <!--            console.log("Loader should be visible now");-->

    <!--            fetch(`/admin/exportProposalSchedule?program=${encodeURIComponent(program)}`, {-->
    <!--              method: "GET",-->
    <!--            })-->
    <!--                    .then(response => {-->
    <!--                      if (!response.ok){-->

    <!--                        document.getElementById("modalLoaderOverlay").style.display = "none";-->

    <!--                      throw new Error('Network response was not ok ' + response.statusText);-->

    <!--                      }-->

    <!--                      const filename = response.headers.get('content-disposition')-->
    <!--                              .split('filename=')[1]-->
    <!--                              // à¹€à¸­à¸² " à¸­à¸­à¸à¸ˆà¸²à¸Šà¸·à¹ˆà¸­-->
    <!--                              .replace(/"/g, '');-->

    <!--                      // blob -> Binary Large Object-->
    <!--                      return response.blob().then(blob => {-->
    <!--                        return {blob, filename};-->
    <!--                      });-->

    <!--                    })-->
    <!--                    .then(data => {-->

    <!--                      // https://stackoverflow.com/questions/19327749/javascript-blob-filename-without-link-->

    <!--                      // temp url-->
    <!--                      const url = window.URL.createObjectURL(data.blob);-->

    <!--                      // <a href="https://example.com">Website</a>-->
    <!--                      const a = document.createElement("a");-->

    <!--                      a.style.display = "none";-->
    <!--                      a.href = url;-->
    <!--                      a.download = data.filename;-->

    <!--                      document.body.appendChild(a);-->
    <!--                      a.click();-->

    <!--                      window.URL.revokeObjectURL(url);-->

    <!--                      document.getElementById("modalLoaderOverlay").style.display = "none";-->

    <!--                      Swal.fire({-->
    <!--                        icon: "success",-->
    <!--                        title: "Export schedule successfully.",-->
    <!--                        showConfirmButton: false,-->
    <!--                        timer: 2000-->
    <!--                      });-->
    <!--                    })-->
    <!--                    .catch(error => {-->
    <!--                              console.error("Error exporting schedule:", error);-->
    <!--                       document.getElementById("modalLoaderOverlay").style.display = "none";-->

    <!--                      Swal.fire({-->
    <!--                                icon: "error",-->
    <!--                                title: "Oops...",-->
    <!--                                text: "Something went wrong!",-->
    <!--                              });-->
    <!--                            }-->
    <!--                    );-->
    <!--          });-->

    <!--        </script>-->

    <button class="delete-block" onclick="deleteClickSchedule()">Delete All</button>

  </div>
</div>

<!--    <div class="slot-box ${project.status === "Non-Active" ? "non-active" : (project.status === 'Edit-Active' ? 'edit-active' : '')}"><br><div class="project-id">${project.projectId}</div><br><div class="instructors"></div>-->

<!--    <div class="icon-container">-->

<!--      <div class="icon-edit ${project.status === 'Edit-Active' || project.status === "Active"? "hidden" : ''}">-->
<!--      <input type="hidden" id="hiddenEditInfo" name="projectId" value="${project.projectId}">-->
<!--      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">-->
<!--        <path d="M16.4612 1.53747C15.2966 0.372875 13.4084 0.372933 12.2439 1.5376L2.28549 11.4971C1.94688 11.8358 1.70888 12.2617 1.59797 12.7276L0.684976 16.5621C0.634709 16.7733 0.697568 16.9954 0.851034 17.1489C1.00451 17.3023 1.22661 17.3652 1.43774 17.3149L5.27212 16.402C5.73812 16.291 6.16418 16.0529 6.50289 15.7141L14.8342 7.38187C15.3994 7.95171 15.398 8.87187 14.8299 9.43996L13.3437 10.9261C13.0996 11.1702 13.0996 11.5659 13.3437 11.81C13.5878 12.054 13.9835 12.054 14.2276 11.81L15.7138 10.3238C16.77 9.26762 16.7715 7.55596 15.7181 6.49793L16.4613 5.75457C17.6257 4.59 17.6257 2.70198 16.4612 1.53747ZM13.1278 2.42143C13.8041 1.74497 14.9009 1.74493 15.5773 2.42136C16.2536 3.09772 16.2537 4.19432 15.5774 4.87074L5.61896 14.8303C5.44383 15.0055 5.22353 15.1285 4.98259 15.186L2.13623 15.8636L2.81398 13.0171C2.87132 12.7763 2.99437 12.556 3.16943 12.381L13.1278 2.42143Z" fill="currentColor"/>-->
<!--      </svg>-->
<!--    </div>-->

<!--    <div class="icon-delete ${project.status === "Non-Active" || project.status === 'Edit-Active' ? "hidden" : ''}">-->
<!--    <input type="hidden" id="hiddenInfo" name="projectId" value="${project.projectId}">-->
<!--    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">-->
<!--      <path d="M5.20833 2.5C3.71256 2.5 2.5 3.71257 2.5 5.20833V14.7917C2.5 16.2874 3.71257 17.5 5.20833 17.5H14.7917C16.2874 17.5 17.5 16.2874 17.5 14.7917V5.20833C17.5 3.71256 16.2874 2.5 14.7917 2.5H5.20833ZM6.84973 6.84973C7.0938 6.60565 7.48953 6.60565 7.73361 6.84973L10 9.11608L12.2664 6.84973C12.5105 6.60565 12.9062 6.60565 13.1502 6.84973C13.3943 7.0938 13.3943 7.48953 13.1502 7.73361L10.8839 10L13.1502 12.2664C13.3943 12.5105 13.3943 12.9062 13.1502 13.1502C12.9062 13.3943 12.5105 13.3943 12.2664 13.1502L10 10.8839L7.73361 13.1502C7.48953 13.3943 7.0938 13.3943 6.84973 13.1502C6.60565 12.9062 6.60565 12.5105 6.84973 12.2664L9.11608 10L6.84973 7.73361C6.60565 7.48953 6.60565 7.0938 6.84973 6.84973Z" fill="currentColor"/>-->
<!--    </svg>-->
<!--    </div>-->
<!--    </div>-->
<!--    </div>-->


<!--    <div class="slot-box ${project.status === "Non-Active" ? "non-active" : (project.status === 'Edit-Active' ? 'edit-active' : '')}"><br><div class="project-id">${project.projectId}</div><br><div class="instructors"></div>-->
<!--    &lt;!&ndash; <svg id="icon-edit" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">&ndash;&gt;-->
<!--    &lt;!&ndash;     <path d="M16.4612 1.53747C15.2966 0.372875 13.4084 0.372933 12.2439 1.5376L2.28549 11.4971C1.94688 11.8358 1.70888 12.2617 1.59797 12.7276L0.684976 16.5621C0.634709 16.7733 0.697568 16.9954 0.851034 17.1489C1.00451 17.3023 1.22661 17.3652 1.43774 17.3149L5.27212 16.402C5.73812 16.291 6.16418 16.0529 6.50289 15.7141L14.8342 7.38187C15.3994 7.95171 15.398 8.87187 14.8299 9.43996L13.3437 10.9261C13.0996 11.1702 13.0996 11.5659 13.3437 11.81C13.5878 12.054 13.9835 12.054 14.2276 11.81L15.7138 10.3238C16.77 9.26762 16.7715 7.55596 15.7181 6.49793L16.4613 5.75457C17.6257 4.59 17.6257 2.70198 16.4612 1.53747ZM13.1278 2.42143C13.8041 1.74497 14.9009 1.74493 15.5773 2.42136C16.2536 3.09772 16.2537 4.19432 15.5774 4.87074L5.61896 14.8303C5.44383 15.0055 5.22353 15.1285 4.98259 15.186L2.13623 15.8636L2.81398 13.0171C2.87132 12.7763 2.99437 12.556 3.16943 12.381L13.1278 2.42143Z" fill="#878D96"/>&ndash;&gt;-->
<!--    &lt;!&ndash; </svg>&ndash;&gt;-->
<!--    <div class="icon-delete ${project.status === "Non-Active" || project.status === 'Edit-Active' ? "hidden" : ''}">-->
<!--    <input type="hidden" id="hiddenInfo" name="projectId" value="${project.projectId}">-->
<!--    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">-->
<!--      <path d="M5.20833 2.5C3.71256 2.5 2.5 3.71257 2.5 5.20833V14.7917C2.5 16.2874 3.71257 17.5 5.20833 17.5H14.7917C16.2874 17.5 17.5 16.2874 17.5 14.7917V5.20833C17.5 3.71256 16.2874 2.5 14.7917 2.5H5.20833ZM6.84973 6.84973C7.0938 6.60565 7.48953 6.60565 7.73361 6.84973L10 9.11608L12.2664 6.84973C12.5105 6.60565 12.9062 6.60565 13.1502 6.84973C13.3943 7.0938 13.3943 7.48953 13.1502 7.73361L10.8839 10L13.1502 12.2664C13.3943 12.5105 13.3943 12.9062 13.1502 13.1502C12.9062 13.3943 12.5105 13.3943 12.2664 13.1502L10 10.8839L7.73361 13.1502C7.48953 13.3943 7.0938 13.3943 6.84973 13.1502C6.60565 12.9062 6.60565 12.5105 6.84973 12.2664L9.11608 10L6.84973 7.73361C6.60565 7.48953 6.60565 7.0938 6.84973 6.84973Z" fill="currentColor"/>-->
<!--    </svg>-->
<!--    </div>-->
<!--    </div>-->


</body>

</html>

<!-- ===================================================================  Modal =================================================================== -->

<script>

  function fetchData() {
    let url = 'http://localhost:8080/admin/roomFloorSetting';

    fetch(url)
            .then(response => {
              // console.log(response.json());
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
              }
              return response.json();
            })
            .then(data => {
              // console.log("ðŸ Data Length: " + data.length);
              // console.log("Show Data: " + JSON.stringify(data, null, 2));

              rooms.length = 0;

              for(const key in data) {

                rooms.push({
                  name: key,
                  floor: data[key]
                });

              }

              // console.log("ðŸ rooms: " + rooms);

              // https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_localecompare2
              rooms.sort((a, b) => {

                if(a.floor !== b.floor) {

                  return a.floor.localeCompare(b.floor);
                }

                return a.name.localeCompare(b.name);

              });

              // rooms.forEach(room => {
              //   console.log("Room: " + room.name + ", Floor: " + room.floor);
              // })

              const dropdown = document.getElementById("dropdown-content");
              if (dropdown.style.display === "block") {

                showFloors();

              }

            })
            .catch(error => {
              console.error('Error fetching data:', error);
              document.getElementById('filter-results').innerHTML = "à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¹‰à¸­à¸‡";
            });
  }

  document.addEventListener('DOMContentLoaded', async function () {
    console.log("ðŸš€ Load Page");
    await getScheduleData();
    await fetchData();
    await fetchAcademicYears();
  });


  // open modal
  document.getElementById("openModal").addEventListener("click", function() {
    console.log("ðŸ“Œ Open modal");
    document.getElementById("settingModal").style.display = "block";
  });

  // close modal
  function closeModal() {
    console.log("âŒ Close Modal");
    document.getElementById("settingModal").style.display = "none";

    document.querySelectorAll("input[type='date']").forEach(input => {
      input.value = "";
      input.removeAttribute("min");
      input.removeAttribute("max");
    });

    document.querySelector("input[type='time']").value = "";
    document.querySelectorAll("input[type='time']")[1].value = "";

    document.getElementById("selected-text").textContent = "Select Room";
    selectedRooms.clear();
    const checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
    checkboxes.forEach(cb => {

      cb.checked = false;

    });

    let selectAllCheckbox = document.getElementById("select-all");

    if(selectAllCheckbox) {

      selectAllCheckbox.checked = false;

    }
  }

  document.getElementById("cancelBtn").addEventListener("click", closeModal);


  // click out modal
  // https://stackoverflow.com/questions/45393553/window-onclick-functionevent-only-works-for-first-item
  // window.onclick = function(event) {
  //   let modal = document.getElementById("settingModal");
  //
  //   if (event.target === modal) {
  //     // console.log("ðŸ‘€ Event: " + event.target);
  //     // console.dir(event.target);
  //     // console.log("ðŸ™‚ Modal: " + modal);
  //     // console.dir(modal);
  //     console.log("â›” à¸„à¸¥à¸´à¸à¸™à¸­à¸ Modal -> à¸›à¸´à¸” Modal");
  //     closeModal();
  //   }
  //
  // };

  // date (https://stackoverflow.com/questions/20491326/start-and-end-date-validation-in-html5)
  const startDate = document.querySelector("#start-date");
  const endDate = document.querySelector("#end-date");

  startDate.addEventListener('change', function () {

    if (startDate.value) {
      endDate.min = startDate.value
    }

  }, false);

  endDate.addEventListener('change', function () {

    if (endDate.value) {
      startDate.max = endDate.value
    }

  }, false);

  // https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_onblur (blur)
  endDate.addEventListener('blur', function () {

    if (endDate.value && startDate.value && endDate.value < startDate.value) {
      Swal.fire({
        icon: "error",
        title: "Sorry!",
        text: "End date cannot be earlier than the Start date.",
        draggable: true,
        confirmButtonColor: "#dc3360"
      });

      endDate.value = "";
      endDate.min = "";
    }

  });

  startDate.addEventListener('blur', function () {

    if (startDate.value && endDate.value && startDate.value > endDate.value) {
      Swal.fire({
        icon: "error",
        title: "Sorry!",
        text: "Start date cannot be more than End date",
        draggable: true,
        confirmButtonColor: "#dc3360"
      });

      startDate.value = "";
      startDate.max = "";
    }

  });


  // room
  const rooms = []; // Object {name, floor}
  let selectedRooms = new Set();
  let selectedFloor = null;

  function getFloors() {

    const flors = new Set();
    rooms.forEach(room => flors.add(room.floor));

    return Array.from(flors).sort();
  }

  function toggleDropdown() {
    let dropdown = document.getElementById("dropdown-content");
    let isVisible = dropdown.style.display === "block";
    console.log(`${isVisible}`);

    dropdown.style.display = isVisible ? "none" : "block";
    console.log(`ðŸ“‚ Dropdown ${isVisible ? "close" : "open"}`);

    if (!isVisible) {

      // showFloors();
      if(selectedFloor === null) {

        selectedFloor = "3";
        showRoomsByFloor("3");

      }

    }

  }

  function showFloors() {

    let roomList = document.getElementById("room-list");
    roomList.innerHTML = "";

    // set
    document.getElementById("search-container").style.display = "none";
    document.getElementById("back-button").style.display = "none";
    document.getElementById("floor-title").textContent = "Select Floor";
    document.getElementById("select-all-container").style.display = "none";

    const floors = getFloors();

    console.log("ðŸ¢ à¹à¸ªà¸”à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸Šà¸±à¹‰à¸™:", floors);

    floors.forEach(floor => {

      let floorItem = document.createElement("div");
      floorItem.classList.add("floor-item");
      floorItem.textContent = `Floor ${floor}`;

      // à¹€à¸à¹‡à¸šà¸„à¹ˆà¸² room à¹ƒà¸™à¹€à¹€à¸•à¹ˆà¸¥à¸°à¸Šà¸±à¹‰à¸™
      const selectedInFloor = Array.from(selectedRooms).filter(roomName => {

        const roomObj = rooms.find(r => r.name === roomName);

        return roomObj && roomObj.floor === floor;
      });

      if(selectedInFloor.length > 0) {

        let countBadge = document.createElement("span");

        countBadge.classList.add("count-badge");
        // à¸™à¸±à¸šà¸ˆà¸™.
        countBadge.textContent = selectedInFloor.length;
        floorItem.appendChild(countBadge);

      }

      floorItem.onclick = function () {

        selectedFloor = floor;
        showRoomsByFloor(floor);

      };

      roomList.appendChild(floorItem);

    });

    updateSelectedCount();

  }

  // à¸à¸£à¸­à¸‡ room à¹€à¹€à¸•à¹ˆà¸¥à¸°à¸Šà¸±à¹‰à¸™à¹€à¸žà¸·à¹ˆà¸­à¹„à¸› create
  function showRoomsByFloor(floor) {

    let roomList = document.getElementById("room-list");
    roomList.innerHTML = "";

    document.getElementById("search-container").style.display = "block";
    document.getElementById("back-button").style.display = "flex";
    document.getElementById("floor-title").textContent = `Floor ${floor}`;
    document.getElementById("select-all-container").style.display = "block";
    document.getElementById("dropdown-content").style.display = "block";

    console.log(`ðŸ¢ à¹à¸ªà¸”à¸‡à¸«à¹‰à¸­à¸‡à¹ƒà¸™à¸Šà¸±à¹‰à¸™ ${floor}`);

    const roomsInFloor = rooms.filter(room => room.floor === floor)
            .map(room => room.name);

    createRooms(roomsInFloor);

  }

  function filterRooms() {

    console.log("Floor:", selectedFloor)

    if(!selectedFloor) return;

    // change
    let searchValue = document.getElementById("search").value.toLowerCase();
    console.log(`ðŸ”Ž Find: ${searchValue}`);

    let filteredRooms = rooms.filter(room => room.name.toLowerCase().includes(searchValue) && room.floor === selectedFloor)
            .map(room => room.name);
    console.log("ðŸ“‹ Result:", filteredRooms);

    createRooms(filteredRooms); // à¸«à¸¥à¸±à¸‡à¸„à¹‰à¸™à¸«à¸²
  }

  function createRooms(roomNames = []) {
    document.getElementById("select-all-container").style.display = "block";

    let roomList = document.getElementById("room-list");
    roomList.innerHTML = ""; // clear

    console.log("ðŸ”„ Load new room");
    console.log("ðŸ” Room:", roomNames);

    // if(roomNames.length === 0 && selectedFloor) {
    //   roomNames = rooms.filter(room => room.floor === selectedFloor)
    //           .map(room => room.name);
    // }

    if (roomNames.length === 0) {

      let noResult = document.createElement("div");
      noResult.textContent = "Room not found.";
      noResult.style.color = "#888";
      noResult.style.padding = "1rem";
      roomList.appendChild(noResult);
      updateSelectedCount();
      document.getElementById("select-all-container").style.display = "none";

      return;
    }

    roomNames.forEach(room => {

      let label = document.createElement("label");
      label.classList.add("room-label");
      let checkbox = document.createElement("input");

      checkbox.type = "checkbox";
      checkbox.value = room;
      checkbox.checked = selectedRooms.has(room);

      checkbox.onchange = function () {
        if (checkbox.checked) {
          selectedRooms.add(room);
          console.log(`âœ… Select room: ${room}`);
        } else {
          selectedRooms.delete(room);
          console.log(`âŒ Delete room: ${room}`);
        }
        updateSelectedCount();
      };

      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(` ${room}`));
      roomList.appendChild(label);
      // roomList.appendChild(document.createElement("br"));
    });

    updateSelectedCount();
    updateSelectAllCheckbox();
  }

  function selectAll() {
    let selectAllCheckbox = document.getElementById("select-all");
    let checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
    // keep true, false;
    let isChecked = selectAllCheckbox.checked;

    console.log(isChecked ? "ðŸ”˜ Select all" : "â­• Cancle all");

    checkboxes.forEach(cb => {
      cb.checked = isChecked;

      if (isChecked) {
        selectedRooms.add(cb.value);
      } else {
        selectedRooms.delete(cb.value);
      }

    });

    updateSelectedCount();
  }

  function updateSelectAllCheckbox() {
    const checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
    const total = checkboxes.length;
    const checked = Array.from(checkboxes).filter(cb => cb.checked).length;

    document.getElementById("select-all").checked = total > 0 && total === checked;
  }


  function updateSelectedCount() {
    let count = selectedRooms.size;

    if (count > 0) {
      document.getElementById("selected-text").textContent = `${count} Selected`;
    } else {
      document.getElementById("selected-text").textContent = "Select Room";
    }

    console.log(`ðŸ“Š Count room: ${count}`);
    console.log("ðŸ“‹ List room:", [...selectedRooms]);
  }

  function backToFloors() {

    selectedFloor = null;
    showFloors();

  }


  // close dropdown room
  document.addEventListener("click", function(event) {

    if (!event.target.closest(".dropdown") && !event.target.closest(".floor-item")) {
      document.getElementById("dropdown-content").style.display = "none";
      // console.log("ðŸ“Œ à¸„à¸¥à¸´à¸à¸‚à¹‰à¸²à¸‡à¸™à¸­à¸ -> à¸›à¸´à¸” Dropdown");
    }

  });



  <!-- ===================================================================  Generate =================================================================== -->


  function getCsrfToken() {

    let tokenInput = document.getElementById("csrfToken");

    if (tokenInput && tokenInput.value) {
      return tokenInput.value;
    }

    console.error("â›” CSRF token not found.");
    return "dummy-token";
  }



  // send value to controlller
  document.getElementById("saveBtn").addEventListener("click", function () {
    let startDateInput = document.querySelector("input[type='date']");
    let endDateInput = document.querySelectorAll("input[type='date']")[1];
    let startTimeInput = document.querySelector("input[type='time']");
    let endTimeInput = document.querySelectorAll("input[type='time']")[1];
    let program = document.getElementById("program-text").textContent;
    const semesterYear = document.getElementById("semester-selector").value;

    // console.log("startDateInput:", startDateInput);
    // console.log("endDateInput:", endDateInput);
    // console.log("startTimeInput:", startTimeInput);
    // console.log("endTimeInput:", endTimeInput);
    // console.log("program:", program);


    let startDate = startDateInput.value;
    let endDate = endDateInput.value;
    let startTime = startTimeInput.value;
    let endTime = endTimeInput.value;
    let selectedRoom = [...selectedRooms];
    let programData = program;

    let startDateTime = new Date(`${startDate}T${startTime}`)
    let endDateTime = new Date(`${endDate}T${endTime}`)

    if (!startDate || !endDate || !startTime || !endTime || selectedRoom.length === 0) {
      Swal.fire({
        icon: "warning",
        title: "Oops...",
        text: "Please fill in all information.",
        draggable: true,
        confirmButtonColor: "#dc7633"
      });
      return;
    }

    if(startDateTime >= endDateTime) {
      Swal.fire({
        icon: "warning",
        title: "Oops...",
        text: "Start time must be before end time.",
        draggable: true,
        confirmButtonColor: "#dc7633"
      });
      return;
    }

    let csrfToken = getCsrfToken();
    console.log("ðŸ‘€ CSRF Token: ", csrfToken);

    if (!csrfToken || csrfToken === "dummy-token") {
      alert("CSRF Token Invalidâ—ï¸");
      return;
    }

    //check exits
    fetch(`http://localhost:8080/admin/checkExitsSchedule?program=${encodeURIComponent(programData)}&semesterYear=${encodeURIComponent(semesterYear)}`, {

      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      }
    })
            .then(response => response.json())
            .then(data => {

              const exists = data.checkEexti;
              console.log("Schedule exists:", exists);

              if (exists) {

                Swal.fire({
                  icon: "warning",
                  title: "Existing Schedules Found",
                  text: "Projects from this program already have proposal schedules. Please delete existing schedules first.",
                  showConfirmButton: true,
                  confirmButtonColor: "#3085d6",
                  confirmButtonText: "Delete",
                  showCancelButton: true,
                  cancelButtonText: "Cancel",
                  cancelButtonColor: "#d33"
                }) .then((result) => {

                  if (result.isConfirmed) {
                    deleteAllSchedule();
                    // location.reload();
                  }

                });
              } else {
                saveScheduleData();
              }
            })
            .catch(error => {
              console.error('Error:', error);
              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Error checking existing schedules!",
              });
            });

    function deleteAllSchedule() {

      fetch(`http://localhost:8080/admin/deleteAllExitsSchedule?program=${encodeURIComponent(programData)}&semesterYear=${encodeURIComponent(semesterYear)}`, {

        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })

              .then(response => response.json())
              .then(data => {
                const statusDeleteAll = data.deleteStatus;
                console.log("Schedule success delete:", statusDeleteAll);

                if (statusDeleteAll) {
                  const schedule = document.querySelector(".schedule");
                  const container = document.querySelector(".container");
                  const table = document.querySelector("table");
                  schedule.innerHTML = "";
                  container.innerHTML = ""

                  Swal.fire({
                    icon: "success",
                    title: "Delete successfully.",
                    showConfirmButton: false,
                    timer: 2000
                  });

                  getScheduleData();
                }
              })
              .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Failed to delete schedules!",
                });
              });
    }

    function saveScheduleData() {
      let settingData = {
        startDate: startDate,
        endDate: endDate,
        startTime: startTime,
        endTime: endTime,
        rooms: selectedRoom,
        program: programData,
        semester: semesterYear
      };

      console.log("ðŸ“¤ settingData: ", settingData);

      document.getElementById("modalLoaderOverlay").style.display = "flex";

      fetch('http://localhost:8080/admin/bookingSave', {

        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-TOKEN': csrfToken
        },
        body: JSON.stringify(settingData)

      })
              .then(response =>
                      response.json()
              )
              .then(data => {

                console.log('ðŸŒ¼ Data:', data);

                if (data.status === "error") {

                  document.getElementById("modalLoaderOverlay").style.display = "none";

                  Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: data.message,
                    showConfirmButton: false,
                    showCancelButton: true,
                    cancelButtonText: "Cancel",
                    cancelButtonColor: "#d33"
                  });
                } else {
                  const projectId = data.scheduledAssignments[0]?.projectId;
                  console.log('ðŸŒ¾ projectId: ', projectId);

                  // ====================================== call list date =====================================
                  const getDate = getScheduleDate(data);
                  // console.log("ðŸ—“ï¸ List of Date: " +  getScheduleDate(data));

                  const getDateFormat = formatDate(getDate).sort((a, b) => new Date(a) - new Date(b));
                  console.log("ðŸ—“ï¸ List of Date: " +  formatDate(getDate));

                  const schedule = document.querySelector(".schedule");
                  schedule.innerHTML = ""

                  const backgroundSchedule = document.createElement("div");
                  backgroundSchedule.className = "background-schedule";

                  const scheduleContainer = document.createElement("div");
                  scheduleContainer.className = "schedule-contanier";

                  const scheduleHeader = document.createElement("div");
                  scheduleHeader.className = "shedule-header";

                  const prevButton = document.createElement("button");
                  prevButton.className = "nav-button pre-button";
                  prevButton.textContent = "â®";

                  const dateTitle = document.createElement("h2");
                  dateTitle.className = "date-title";

                  const nextButton = document.createElement("button");
                  nextButton.className = "nav-button next-button";
                  nextButton.textContent = "â¯";

                  scheduleHeader.appendChild(prevButton);
                  scheduleHeader.appendChild(dateTitle);
                  scheduleHeader.appendChild(nextButton);

                  backgroundSchedule.appendChild(scheduleHeader);

                  // ====================================== room =====================================

                  const scheduleTable = document.createElement("div");
                  scheduleTable.className = "schedule-table";

                  const table = document.createElement("table");
                  const thead = document.createElement("thead");
                  const rowHeader = document.createElement("tr");
                  const timeHeader = document.createElement("th");

                  timeHeader.textContent = "Time";
                  timeHeader.className = "time-column";
                  rowHeader.appendChild(timeHeader);

                  const rooms = [...new Set(data.scheduledAssignments.map(proj => proj.roomNumber))];
                  console.log("â˜„ï¸ Room: "+rooms);

                  rooms.forEach(room => {
                    const th = document.createElement("th");
                    th.textContent = room;
                    console.log("room: "+room);
                    rowHeader.appendChild(th);
                  });

                  thead.appendChild(rowHeader);
                  table.appendChild(thead);

                  let tableBody = document.createElement("tbody");

                  let currentDateIndex = 0;

                  function updateScheduleDisplay() {

                    if (getDateFormat.length === 0) return;

                    // à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸²à¸ list
                    const currentDate = getDateFormat[currentDateIndex];
                    dateTitle.textContent = currentDate;

                    prevButton.disabled = currentDateIndex === 0;
                    nextButton.disabled = currentDateIndex === getDateFormat.length - 1;

                    tableBody.innerHTML = "";

                    console.log("currentDate: "+currentDate);

                    // select pj à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸š à¸§à¸±à¸™à¸—à¸µà¹ˆ
                    const assignProjectDay = data.scheduledAssignments.filter(project => {

                      const projectDate = new Date(project.startTime).toLocaleDateString();
                      const currentDateObj = new Date(Date.parse(currentDate));
                      const selectDate = currentDateObj.toLocaleDateString();
                      console.log("currentDateObj: "+currentDateObj);
                      console.log("selectDate: "+selectDate);
                      return projectDate === selectDate;
                    });

                    console.log("assignProjectDay: "+assignProjectDay);

                    // list à¸‚à¸­à¸‡ time, room, project
                    const timeSlots = {};

                    // à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸§à¸¥à¸²à¹ƒà¸™ schedule
                    assignProjectDay.forEach(project => {

                      const startTime = new Date(project.startTime);
                      const endTime = new Date(project.endTime);

                      const timeSlot = `${String(startTime.getHours()).padStart(2, '0')}:${String(startTime.getMinutes()).padStart(2, '0')} - ${String(endTime.getHours()).padStart(2, '0')}:${String(endTime.getMinutes()).padStart(2, '0')}`;
                      console.log("ðŸ•°ï¸timeSlot: "+timeSlot);

                      if (!timeSlots[timeSlot]) {
                        timeSlots[timeSlot] = {
                          isBreak: false,
                          breakLabel: "",
                          project: {}
                        };
                        console.log("creat time slots: "+ timeSlots);
                      }

                      timeSlots[timeSlot][project.roomNumber] = project;
                      console.log("time slots: " + JSON.stringify(timeSlots, null, 2));
                    });

                    // à¹€à¸­à¸² allTimeSlots à¸¡à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸žà¸·à¹ˆà¸­à¸«à¸² break
                    if(data.allTimeSlots) {

                      data.allTimeSlots.forEach(timeSlotDTO => {

                        console.log("ðŸ“ŒtimeSlotDTO: " + timeSlotDTO);

                        const startTime = new Date(timeSlotDTO.startTime);
                        const endTime = new Date(timeSlotDTO.endTime);

                        const timeSlot = `${String(startTime.getHours()).padStart(2, '0')}:${String(startTime.getMinutes()).padStart(2, '0')} - ${String(endTime.getHours()).padStart(2, '0')}:${String(endTime.getMinutes()).padStart(2, '0')}`;

                        if (!timeSlots[timeSlot]) {
                          timeSlots[timeSlot] = {
                            isBreak: false,
                            breakLabel: "",
                            project: {}
                          };
                        }

                        timeSlots[timeSlot].isBreak = timeSlotDTO.break;
                        timeSlots[timeSlot].breakLabel = timeSlotDTO.breakLabel;

                      })
                    }

                    // sort time
                    const sortTimeSlots =  Object.keys(timeSlots).sort((a, b) => {

                      // console.log("ðŸ™Š Check sort time: "+a + " AND "+ b);

                      const [hoursA, minutesA] = a.split(' - ')[0].split(':').map(Number);
                      // console.log([hoursA, minutesA]);
                      const [hoursB, minutesB] = b.split(' - ')[0].split(':').map(Number);
                      // console.log([hoursB, minutesB]);


                      const totalMinutesA = hoursA * 60 + minutesA;
                      const totalMinutesB = hoursB * 60 + minutesB;
                      // console.log("totalMinutesA: "+ totalMinutesA);
                      // console.log("totalMinutesB: "+ totalMinutesB);

                      return totalMinutesA - totalMinutesB;
                    })

                    console.log("sortTimeSlots: " + sortTimeSlots);

                    sortTimeSlots.forEach((timeSlot, index) => {
                      const slotInfo = timeSlots[timeSlot];

                      // console.log("slotInfo: " + slotInfo);

                      // à¸‚à¹‰à¸²à¸¡à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ pj, break
                      let hasAnyProject = false;

                      if(slotInfo.isBreak) {

                        console.log("âœ… à¹€à¸‚à¹‰à¸² Break " + timeSlot);

                        let hasProjectAfterBreak = false;

                        for(let i = index + 1; i < sortTimeSlots.length; i++) {

                          const futureTimeSlot = sortTimeSlots[i];

                          // à¸­à¸±à¸™à¸™à¸µà¹‰à¸¡à¸±à¸™à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸”à¹‰à¸²à¸™à¹ƒà¸™
                          const futureSlotInfo = timeSlots[futureTimeSlot];

                          if(futureSlotInfo.isBreak) continue;

                          hasProjectAfterBreak = rooms.some(room => futureSlotInfo[room] !== undefined);
                          break
                        }

                        if(!hasProjectAfterBreak) {
                          console.log("âŒ à¹„à¸¡à¹ˆà¸¡à¸µà¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸«à¸¥à¸±à¸‡ Break " + timeSlot + " à¸ˆà¸¶à¸‡à¹„à¸¡à¹ˆà¹à¸ªà¸”à¸‡");
                          return;
                        }

                        const breakRow = document.createElement("tr");
                        breakRow.className = "break-row";

                        const breakCell = document.createElement("td");
                        breakCell.colSpan = rooms.length + 1;
                        // breakCell.className = "break-slot";
                        breakCell.textContent = `${slotInfo.breakLabel} (${timeSlot})`

                        breakRow.appendChild(breakCell);
                        tableBody.appendChild(breakRow);

                      } else {

                        hasAnyProject = rooms.some(room => slotInfo[room] !== undefined);

                        if(!hasAnyProject) {
                          return;
                        }

                        console.log("ðŸ‘€ðŸ‘€timeSlot: " + timeSlot);

                        const row = document.createElement("tr");

                        // à¸„à¸­à¸¥ timeslot à¸à¹ˆà¸­à¸™
                        const timeCell = document.createElement("td");
                        timeCell.className = "time-slot";
                        timeCell.textContent = timeSlot;
                        row.appendChild(timeCell);

                        rooms.forEach(room => {
                          console.log("room: " + room);

                          const cell = document.createElement("td");
                          const project = timeSlots[timeSlot][room];
                          console.log("project: " + project);

                          // à¸–à¹‰à¸²à¸¡à¸µ project à¹ƒà¸™ timeSlot à¸—à¸µà¹ˆ loop
                          if (project) {

                            const instructorUsernames = project.instructorUsernames;

                            cell.innerHTML = `

                                <div class="slot-box ${project.status === "Non-Active" ? "non-active" : ''}"><br><div class="project-id">${project.projectId}</div><br><div class="instructors"></div>
<!--                                  <svg id="icon-edit" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">-->
<!--                                    <path d="M16.4612 1.53747C15.2966 0.372875 13.4084 0.372933 12.2439 1.5376L2.28549 11.4971C1.94688 11.8358 1.70888 12.2617 1.59797 12.7276L0.684976 16.5621C0.634709 16.7733 0.697568 16.9954 0.851034 17.1489C1.00451 17.3023 1.22661 17.3652 1.43774 17.3149L5.27212 16.402C5.73812 16.291 6.16418 16.0529 6.50289 15.7141L14.8342 7.38187C15.3994 7.95171 15.398 8.87187 14.8299 9.43996L13.3437 10.9261C13.0996 11.1702 13.0996 11.5659 13.3437 11.81C13.5878 12.054 13.9835 12.054 14.2276 11.81L15.7138 10.3238C16.77 9.26762 16.7715 7.55596 15.7181 6.49793L16.4613 5.75457C17.6257 4.59 17.6257 2.70198 16.4612 1.53747ZM13.1278 2.42143C13.8041 1.74497 14.9009 1.74493 15.5773 2.42136C16.2536 3.09772 16.2537 4.19432 15.5774 4.87074L5.61896 14.8303C5.44383 15.0055 5.22353 15.1285 4.98259 15.186L2.13623 15.8636L2.81398 13.0171C2.87132 12.7763 2.99437 12.556 3.16943 12.381L13.1278 2.42143Z" fill="#878D96"/>-->
<!--                                 </svg>-->
                                   <div class="icon-delete ${project.status === "Non-Active" ? "hidden" : ''}">
                                        <input type="hidden" id="hiddenInfo" name="projectId" value="${project.projectId}">
                                       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M5.20833 2.5C3.71256 2.5 2.5 3.71257 2.5 5.20833V14.7917C2.5 16.2874 3.71257 17.5 5.20833 17.5H14.7917C16.2874 17.5 17.5 16.2874 17.5 14.7917V5.20833C17.5 3.71256 16.2874 2.5 14.7917 2.5H5.20833ZM6.84973 6.84973C7.0938 6.60565 7.48953 6.60565 7.73361 6.84973L10 9.11608L12.2664 6.84973C12.5105 6.60565 12.9062 6.60565 13.1502 6.84973C13.3943 7.0938 13.3943 7.48953 13.1502 7.73361L10.8839 10L13.1502 12.2664C13.3943 12.5105 13.3943 12.9062 13.1502 13.1502C12.9062 13.3943 12.5105 13.3943 12.2664 13.1502L10 10.8839L7.73361 13.1502C7.48953 13.3943 7.0938 13.3943 6.84973 13.1502C6.60565 12.9062 6.60565 12.5105 6.84973 12.2664L9.11608 10L6.84973 7.73361C6.60565 7.48953 6.60565 7.0938 6.84973 6.84973Z" fill="currentColor"/>
                                       </svg>
                                   </div>
                               </div>
                                `;

                            let instructorList = '';

                            if(instructorUsernames) {
                              instructorList = instructorUsernames.map(name => `${name}`).join(', ');
                            } else {
                              instructorList = 'No instructors available';
                            }

                            const instructorDiv = cell.querySelector(".instructors");
                            instructorDiv.innerHTML = instructorList;
                          }
                          row.appendChild(cell);
                        });
                        tableBody.appendChild(row);
                      }
                    });

                    table.appendChild(tableBody);
                    scheduleTable.appendChild(table);
                    backgroundSchedule.appendChild(scheduleTable);
                    schedule.appendChild(backgroundSchedule);

                  }

                  updateScheduleDisplay();

                  prevButton.addEventListener("click", () => {

                    if(currentDateIndex > 0) {
                      currentDateIndex --;
                      updateScheduleDisplay();
                    }

                  })

                  nextButton.addEventListener("click", () => {

                    if(currentDateIndex < getDateFormat.length -1 ) {
                      currentDateIndex ++;
                      updateScheduleDisplay();
                    }
                  })

                  if (Array.isArray(data.unscheduledProjects) && data.unscheduledProjects.length >0) {

                    const container = document.querySelector(".container");
                    container.innerHTML = ""

                    const backgroundUnSchedule = document.createElement("div");
                    backgroundUnSchedule.className = "unscheduled-projects";

                    const headerUnSchedule = document.createElement("div");
                    headerUnSchedule.className = "header";
                    headerUnSchedule.innerHTML =  `
                           <i class="fa-solid fa-calendar-xmark"></i>
                           Unscheduled Project `;

                    backgroundUnSchedule.appendChild(headerUnSchedule);

                    const warningHeader = document.createElement("div");
                    warningHeader.className = "warning-header";
                    warningHeader.innerHTML = `
                        <i class="fa-solid fa-triangle-exclamation warning-icon"></i>
                        <div class="warning-text">The following projects could not be scheduled due to insufficient rooms or time slots.</div>
                      `;
                    backgroundUnSchedule.appendChild(warningHeader);

                    const projectsList = document.createElement("div");
                    projectsList.className = "projects-list";

                    const sortedProjects = data.unscheduledProjects.sort((a, b) => {

                      const projectIdA = a.project.projectId;
                      const projectIdB = b.project.projectId;

                      return projectIdA.localeCompare(projectIdB);

                    });


                    sortedProjects.forEach(item => {

                      const project = item.project;
                      const instructorUsernames = item.instructorUsernames;

                      const projectItem = document.createElement("div");
                      projectItem.className = "project-item";

                      const projectHeader = document.createElement("div");
                      projectHeader.className = "project-header";

                      const projectId = document.createElement("div");
                      projectId.className = "project-id-new";
                      projectId.textContent = project.projectId;

                      const tagContainer = document.createElement("div");
                      tagContainer.className = "tag-container";

                      const categoryTag = document.createElement("span");
                      categoryTag.className = "tag tag-proposal";
                      categoryTag.textContent = "Proposal";
                      tagContainer.appendChild(categoryTag);

                      const programTag = document.createElement("span");
                      programTag.className = `tag tag-${project.program.toLowerCase()}`;
                      programTag.textContent = project.program;
                      tagContainer.appendChild(programTag);

                      projectHeader.appendChild(projectId);
                      projectHeader.appendChild(tagContainer);

                      // Title
                      const projectTitle = document.createElement("div");
                      projectTitle.className = "project-title";
                      projectTitle.textContent = project.projectTitle;

                      // Instructors
                      const instructorSection = document.createElement("div");
                      instructorSection.className = "instructor-section";

                      const instructorLabel = document.createElement("div");
                      instructorLabel.className = "instructor-label";
                      instructorLabel.textContent = "Instructors:";

                      const instructorsList = document.createElement("div");
                      instructorsList.className = "instructors-list";
                      instructorUsernames.forEach(name => {

                        const instructorChip = document.createElement("div");
                        instructorChip.className = "instructor-chip";
                        instructorChip.innerHTML = `<i class="fa-solid fa-user"></i> &nbsp; ${name}`;
                        instructorsList.appendChild(instructorChip);
                      });

                      instructorSection.appendChild(instructorLabel);
                      instructorSection.appendChild(instructorsList);

                      projectItem.appendChild(projectHeader);
                      projectItem.appendChild(projectTitle);
                      projectItem.appendChild(instructorSection);

                      projectsList.appendChild(projectItem);
                    });

                    backgroundUnSchedule.appendChild(projectsList);
                    container.appendChild(backgroundUnSchedule);

                  }


                  Swal.fire({
                    icon: "success",
                    title: "Data saved successfully.",
                    showConfirmButton: false,
                    timer: 2000
                  });

                  document.getElementById("modalLoaderOverlay").style.display = "none";

                  document.getElementById("settingModal").style.display = "none";

                  // document.querySelector("input[type='date']").value = "";
                  // document.querySelector("input[type='date']").removeAttribute("min");
                  // document.querySelector("input[type='date']").removeAttribute("max");

                  // document.querySelectorAll("input[type='date']")[1].value = "";
                  // document.querySelector("input[type='date']")[1].removeAttribute("min");
                  // document.querySelector("input[type='date']")[1].removeAttribute("max");

                  document.querySelectorAll("input[type='date']").forEach(input => {

                    input.value = "";
                    input.removeAttribute("min");
                    input.removeAttribute("max");

                  });

                  document.querySelector("input[type='time']").value = "";
                  document.querySelectorAll("input[type='time']")[1].value = "";

                  document.getElementById("selected-text").textContent = "Select Room";
                  selectedRooms.clear();

                  const checkboxes = document.querySelectorAll("#room-list input[type=checkbox]");
                  checkboxes.forEach(cb => {

                    cb.checked = false;

                  });

                  let selectAllCheckbox = document.getElementById("select-all");

                  if(selectAllCheckbox) {

                    selectAllCheckbox.checked = false;

                  }

                }

              }).catch(error => {

        console.error('Error:', error);
        document.getElementById("modalLoaderOverlay").style.display = "none";
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text: "Something went wrong!",
        });
      });
    }

  });

  // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸§à¸±à¸™à¸—à¸µà¹ˆ
  function getScheduleDate(data) {

    const dateSet = new Set();

    data.scheduledAssignments.forEach(project => {

      if(project.startTime) {

        const dateString = project.startTime.split("T")[0];

        dateSet.add(dateString);
      }
    });

    const sortDate = Array.from(dateSet).sort();

    //https://www.w3schools.com/js/js_date_formats.asp
    return sortDate.map(dateStr => new Date(dateStr))
  }

  // change format
  function formatDate(formatDate) {

    const collectDate = [];

    formatDate.forEach(getDay => {

      const dateObj = new Date(getDay);

      //https://stackoverflow.com/questions/3552461/how-do-i-format-a-date-in-javascript/60881661
      let nameDay = dateObj.toLocaleDateString('en-us', {weekday: 'long'})
      let month = dateObj.toLocaleDateString('en-us', {month: 'long'})
      let date = dateObj.toLocaleDateString('en-us', {day: 'numeric'})
      let year = dateObj.toLocaleDateString('en-us', {year: 'numeric'})

      const FormattedDate = `${nameDay}, ${month} ${date}, ${year}`

      collectDate.push(FormattedDate);

    });

    return collectDate;
  }


  <!-- ===================================================================  Get Schedule =================================================================== -->

  function getScheduleData() {
    document.getElementById("modalLoaderOverlay").style.display = "flex";
    let program = document.getElementById("program-text").textContent;
    const semesterYear = document.getElementById("semester-selector").value;

    fetch(`http://localhost:8080/admin/getAllProposalSchedule?program=${encodeURIComponent(program)}&semesterYear=${encodeURIComponent(semesterYear)}`, {

      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      }
    }).then(response => {
      // console.log(response.json());
      if (!response.ok) {
        document.getElementById("modalLoaderOverlay").style.display = "none";

        throw new Error('Network response was not ok ' + response.statusText);
        alert('Network response was not ok ' + response.statusText);
      }
      return response.json();
    })
            .then(data => {
              // console.log("Show Data: " + JSON.stringify(data, null, 2));

              if(JSON.stringify(data) === "{}") {

                const schedule = document.querySelector(".schedule");
                schedule.innerHTML = "";

                const backgroundSchedule = document.createElement("div");
                backgroundSchedule.className = "background-schedule";

                const emptyScheduleImage = document.createElement("img");
                emptyScheduleImage.className = "empty-state-image";
                emptyScheduleImage.src = "/css/warning_schedule-Photoroom.png"

                backgroundSchedule.appendChild(emptyScheduleImage);

                schedule.appendChild(backgroundSchedule);
                document.getElementById("modalLoaderOverlay").style.display = "none";

              } else {

                let rooms = new Set();
                let dates = new Set();

                for(const date in data) {
                  const timeSlots =  data[date];
                  dates.add(date);

                  for(const timeSlot in timeSlots) {
                    const  project = timeSlots[timeSlot];

                    for(const i of project) {
                      rooms.add(i.roomNumber);
                    }
                  }
                }

                rooms.delete("noRoom")

                console.log("â­ï¸ Room: " + Array.from(rooms));

                let myRooms = [];

                //https://www.geeksforgeeks.org/how-to-sort-a-set-in-javascript/
                myRooms = Array.from(rooms)
                myRooms.sort()
                console.log("Room sort: " + myRooms);

                myDate = Array.from(dates)
                myDate.sort()
                console.log("Room sort: " + myDate);

                // ====================================== call list date =====================================

                const getDateFormat = formatDate(myDate).sort((a, b) => new Date(a) - new Date(b));
                console.log("ðŸ—“ï¸ List of Date: " +  getDateFormat);

                const schedule = document.querySelector(".schedule");
                schedule.innerHTML = ""

                const backgroundSchedule = document.createElement("div");
                backgroundSchedule.className = "background-schedule";

                const scheduleContainer = document.createElement("div");
                scheduleContainer.className = "schedule-contanier";

                const scheduleHeader = document.createElement("div");
                scheduleHeader.className = "shedule-header";

                const prevButton = document.createElement("button");
                prevButton.className = "nav-button pre-button";
                prevButton.textContent = "â®";

                const dateTitle = document.createElement("h2");
                dateTitle.className = "date-title";

                const nextButton = document.createElement("button");
                nextButton.className = "nav-button next-button";
                nextButton.textContent = "â¯";

                scheduleHeader.appendChild(prevButton);
                scheduleHeader.appendChild(dateTitle);
                scheduleHeader.appendChild(nextButton);

                backgroundSchedule.appendChild(scheduleHeader);

                // ====================================== room =====================================

                const scheduleTable = document.createElement("div");
                scheduleTable.className = "schedule-table";

                const table = document.createElement("table");
                const thead = document.createElement("thead");
                const rowHeader = document.createElement("tr");
                const timeHeader = document.createElement("th");

                timeHeader.textContent = "Time";
                timeHeader.className = "time-column";
                rowHeader.appendChild(timeHeader);

                myRooms.forEach(room => {
                  const th = document.createElement("th");
                  th.textContent = room;
                  console.log("-_- room: "+room);
                  rowHeader.appendChild(th);
                });

                thead.appendChild(rowHeader);
                table.appendChild(thead);

                let tableBody = document.createElement("tbody");

                let currentDateIndex = 0;

                function updateScheduleDisplay() {

                  if (getDateFormat.length === 0) return;

                  // à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸²à¸ list
                  const currentDate = getDateFormat[currentDateIndex];
                  dateTitle.textContent = currentDate;

                  prevButton.disabled = currentDateIndex === 0;
                  nextButton.disabled = currentDateIndex === getDateFormat.length - 1;

                  tableBody.innerHTML = "";

                  console.log("currentDate: " + currentDate);

                  const currentDateObj = new Date(currentDate);
                  console.log("currentDateObj: " + currentDateObj);

                  const currentDateStr = currentDateObj.toLocaleDateString("en-CA");
                  console.log("currentDateStr: " + currentDateStr);

                  // select pj à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸š à¸§à¸±à¸™à¸—à¸µà¹ˆ  [ "2025-03-06", { "(13:00, 13:25)": [ {...} ] } ],
                  const assignProjectDay = Object.entries(data).filter(([dateKey]) => dateKey === currentDateStr)
                          .flatMap(([dateKey, timeSlots]) =>
                                  Object.entries(timeSlots).map(([timeKey, projects]) => ({
                                    [timeKey]: projects.map(project => ({ ...project }))
                                  }))
                          );

                  // console.log("assignProjectDay: "+assignProjectDay);

                  // for(const project of assignProjectDay) {
                  //   console.log("project: ",project);
                  // }

                  if (assignProjectDay.length === 0) {
                    const noDataRow = document.createElement("tr");
                    const noDataCell = document.createElement("td");
                    noDataCell.colSpan = myRooms.length + 1; // +1 for time slot column
                    noDataCell.textContent = "No schedule available for this date";
                    noDataCell.style.textAlign = "center";
                    noDataCell.style.padding = "20px";
                    noDataRow.appendChild(noDataCell);
                    tableBody.appendChild(noDataRow);
                  } else {

                    // list à¸‚à¸­à¸‡ time, room, project
                    const timeSlotMap = {};
                    assignProjectDay.forEach(projectObj => {
                      // console.log("ðŸ¤¯ Loop");

                      const timeSlotKey = Object.keys(projectObj)[0];
                      // console.log("timeSlotKey: ",timeSlotKey);
                      const projects = projectObj[timeSlotKey];
                      // console.log("projects: ",projects);

                      // create time
                      if(!timeSlotMap[timeSlotKey]) {
                        timeSlotMap[timeSlotKey] = {};
                      }

                      projects.forEach(project => {
                        if(project.roomNumber) {
                          timeSlotMap[timeSlotKey][project.roomNumber] = project;
                          // console.log("time slots: " + JSON.stringify(timeSlotMap, null, 2));
                        }
                      });
                    });

                    Object.keys(timeSlotMap).forEach((timeSlot, index) => {
                      console.log("ðŸ‘€ðŸ‘€timeSlot: " + timeSlot);

                      const allTimeSlots = Object.keys(timeSlotMap);

                      const isBreakTimeSlot = Object.values(timeSlotMap[timeSlot]).some(
                              project => project && project.status === "Break"
                      );

                      if (isBreakTimeSlot) {

                        let hasProjectAfterBreak = false;

                        for(let i = index + 1; i < allTimeSlots.length; i++) {

                          const futureTimeSlot = allTimeSlots[i];

                          // à¸­à¸±à¸™à¸™à¸µà¹‰à¸¡à¸±à¸™à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸”à¹‰à¸²à¸™à¹ƒà¸™
                          const futureSlotInfo = timeSlotMap[futureTimeSlot];

                          const isFutureBreak = Object.values(futureSlotInfo).some(
                                  project => project && project.status === "Break"
                          );

                          if(isFutureBreak) continue;

                          hasProjectAfterBreak = myRooms.some(room => futureSlotInfo[room] !== undefined);
                          break
                        }

                        if(!hasProjectAfterBreak) {
                          console.log("âŒ à¹„à¸¡à¹ˆà¸¡à¸µà¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸«à¸¥à¸±à¸‡ Break " + timeSlot + " à¸ˆà¸¶à¸‡à¹„à¸¡à¹ˆà¹à¸ªà¸”à¸‡");
                          return;
                        }

                        const breakRow = document.createElement("tr");
                        breakRow.className = "break-row";

                        const breakCell = document.createElement("td");
                        breakCell.colSpan = myRooms.length + 1;
                        breakCell.className = "break-slot";

                        const match = timeSlot.match(/\((\d{2}:\d{2}), (\d{2}:\d{2})\)/);
                        const startTime = match[1];
                        const endTime = match[2];

                        breakCell.textContent = `Take a Break (${startTime} - ${endTime})`;

                        breakRow.appendChild(breakCell);
                        tableBody.appendChild(breakRow);
                      } else {

                        const row = document.createElement("tr");

                        const match = timeSlot.match(/\((\d{2}:\d{2}), (\d{2}:\d{2})\)/);
                        const startTime = match[1];
                        const endTime = match[2];

                        // à¸„à¸­à¸¥ timeslot à¸à¹ˆà¸­à¸™
                        const timeCell = document.createElement("td");
                        timeCell.className = "time-slot";
                        timeCell.textContent = `${startTime} - ${endTime}`;
                        row.appendChild(timeCell);

                        myRooms.forEach(room => {

                          console.log("room: " + room);

                          const cell = document.createElement("td");
                          const project = timeSlotMap[timeSlot][room];
                          console.log("project: " + project);

                          // à¸–à¹‰à¸²à¸¡à¸µ project à¹ƒà¸™ timeSlot à¸—à¸µà¹ˆ loop
                          if (project) {

                            const instructorUsernames = project.instructors;

                            cell.innerHTML = `

                                     <div class="slot-box ${project.status === "Non-Active" ? "non-active" : (project.status === 'Edit-Active' ? 'edit-active' : '')}"><br><div class="project-id">${project.projectId}</div><br><div class="instructors"></div>
                                        <!-- <svg id="icon-edit" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">-->
                                        <!--     <path d="M16.4612 1.53747C15.2966 0.372875 13.4084 0.372933 12.2439 1.5376L2.28549 11.4971C1.94688 11.8358 1.70888 12.2617 1.59797 12.7276L0.684976 16.5621C0.634709 16.7733 0.697568 16.9954 0.851034 17.1489C1.00451 17.3023 1.22661 17.3652 1.43774 17.3149L5.27212 16.402C5.73812 16.291 6.16418 16.0529 6.50289 15.7141L14.8342 7.38187C15.3994 7.95171 15.398 8.87187 14.8299 9.43996L13.3437 10.9261C13.0996 11.1702 13.0996 11.5659 13.3437 11.81C13.5878 12.054 13.9835 12.054 14.2276 11.81L15.7138 10.3238C16.77 9.26762 16.7715 7.55596 15.7181 6.49793L16.4613 5.75457C17.6257 4.59 17.6257 2.70198 16.4612 1.53747ZM13.1278 2.42143C13.8041 1.74497 14.9009 1.74493 15.5773 2.42136C16.2536 3.09772 16.2537 4.19432 15.5774 4.87074L5.61896 14.8303C5.44383 15.0055 5.22353 15.1285 4.98259 15.186L2.13623 15.8636L2.81398 13.0171C2.87132 12.7763 2.99437 12.556 3.16943 12.381L13.1278 2.42143Z" fill="#878D96"/>-->
                                        <!-- </svg>-->
                                        <div class="icon-delete ${project.status === "Non-Active" || project.status === 'Edit-Active' ? "hidden" : ''}">
                                        <input type="hidden" id="hiddenInfo" name="projectId" value="${project.projectId}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                          <path d="M5.20833 2.5C3.71256 2.5 2.5 3.71257 2.5 5.20833V14.7917C2.5 16.2874 3.71257 17.5 5.20833 17.5H14.7917C16.2874 17.5 17.5 16.2874 17.5 14.7917V5.20833C17.5 3.71256 16.2874 2.5 14.7917 2.5H5.20833ZM6.84973 6.84973C7.0938 6.60565 7.48953 6.60565 7.73361 6.84973L10 9.11608L12.2664 6.84973C12.5105 6.60565 12.9062 6.60565 13.1502 6.84973C13.3943 7.0938 13.3943 7.48953 13.1502 7.73361L10.8839 10L13.1502 12.2664C13.3943 12.5105 13.3943 12.9062 13.1502 13.1502C12.9062 13.3943 12.5105 13.3943 12.2664 13.1502L10 10.8839L7.73361 13.1502C7.48953 13.3943 7.0938 13.3943 6.84973 13.1502C6.60565 12.9062 6.60565 12.5105 6.84973 12.2664L9.11608 10L6.84973 7.73361C6.60565 7.48953 6.60565 7.0938 6.84973 6.84973Z" fill="currentColor"/>
                                        </svg>
                                        </div>
                                     </div>
                                `;

                            let instructorList = '';

                            if(instructorUsernames) {
                              instructorList = instructorUsernames.map(name => `${name}`).join(', ');
                            } else {
                              instructorList = 'No instructors available';
                            }

                            const instructorDiv = cell.querySelector(".instructors");
                            instructorDiv.innerHTML = instructorList;
                          }

                          row.appendChild(cell);
                        });

                        tableBody.appendChild(row);}
                    });
                  }
                  table.appendChild(tableBody);
                  scheduleTable.appendChild(table);
                  backgroundSchedule.appendChild(scheduleTable);
                  schedule.appendChild(backgroundSchedule);
                  document.getElementById("modalLoaderOverlay").style.display = "none";

                }

                updateScheduleDisplay();

                prevButton.addEventListener("click", () => {

                  if(currentDateIndex > 0) {
                    currentDateIndex --;
                    updateScheduleDisplay();
                  }

                })

                nextButton.addEventListener("click", () => {

                  if(currentDateIndex < getDateFormat.length -1 ) {
                    currentDateIndex ++;
                    updateScheduleDisplay();
                  }
                })

                getUnScheduleData();

              }
            })
            .catch(error => {
              console.error('Error fetching data:', error);
              document.getElementById("modalLoaderOverlay").style.display = "none";

              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
              });
            });

  }


  function getUnScheduleData() {
    let program = document.getElementById("program-text").textContent;
    const semesterYear = document.getElementById("semester-selector").value;

    fetch(`http://localhost:8080/admin/getAllProposalUnSchedule?program=${encodeURIComponent(program)}&semesterYear=${encodeURIComponent(semesterYear)}`, {

      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      }
    }).then(response => {
      // console.log(response.json());
      if (!response.ok) {

        const container = document.querySelector(".container");
        container.innerHTML = ""
        return;

        throw new Error('Network response was not ok ' + response.statusText);
        alert('Network response was not ok ' + response.statusText);
      }
      return response.json();
    })
            .then(data => {
              console.log("ðŸ¤¯ data: " + data);

              const container = document.querySelector(".container");
              // container.style.visibility = "visible";
              container.innerHTML = ""

              if (Array.isArray(data) && data.length >0) {

                // const container = document.querySelector(".container");
                // container.innerHTML = ""

                const backgroundUnSchedule = document.createElement("div");
                backgroundUnSchedule.className = "unscheduled-projects";

                const headerUnSchedule = document.createElement("div");
                headerUnSchedule.className = "header";
                headerUnSchedule.innerHTML =  `
                           <i class="fa-solid fa-calendar-xmark"></i>
                           Unscheduled Project `;

                backgroundUnSchedule.appendChild(headerUnSchedule);

                const warningHeader = document.createElement("div");
                warningHeader.className = "warning-header";
                warningHeader.innerHTML = `
                        <i class="fa-solid fa-triangle-exclamation warning-icon"></i>
                        <div class="warning-text">The following projects could not be scheduled due to insufficient rooms or time slots.</div>
                      `;
                backgroundUnSchedule.appendChild(warningHeader);

                const projectsList = document.createElement("div");
                projectsList.className = "projects-list";

                const sortedProjects = data.sort((a, b) => {

                  const projectIdA = a.projectId;
                  const projectIdB = b.projectId;

                  return projectIdA.localeCompare(projectIdB);

                });


                sortedProjects.forEach(item => {

                  const projectItem = document.createElement("div");
                  projectItem.className = "project-item";

                  const projectHeader = document.createElement("div");
                  projectHeader.className = "project-header";

                  const projectId = document.createElement("div");
                  projectId.className = "project-id-new";
                  projectId.textContent = item.projectId;

                  const tagContainer = document.createElement("div");
                  tagContainer.className = "tag-container";

                  const categoryTag = document.createElement("span");
                  categoryTag.className = "tag tag-proposal";
                  categoryTag.textContent = "Proposal";
                  tagContainer.appendChild(categoryTag);

                  const programTag = document.createElement("span");
                  programTag.className = `tag tag-${item.program.toLowerCase()}`;
                  programTag.textContent = item.program;
                  tagContainer.appendChild(programTag);

                  projectHeader.appendChild(projectId);
                  projectHeader.appendChild(tagContainer);

                  // Title
                  const projectTitle = document.createElement("div");
                  projectTitle.className = "project-title";
                  projectTitle.textContent = item.projectTitle;

                  // Instructors
                  const instructorSection = document.createElement("div");
                  instructorSection.className = "instructor-section";

                  const instructorLabel = document.createElement("div");
                  instructorLabel.className = "instructor-label";
                  instructorLabel.textContent = "Instructors:";

                  const instructorsList = document.createElement("div");
                  instructorsList.className = "instructors-list";
                  item.instructors.forEach(name => {

                    const instructorChip = document.createElement("div");
                    instructorChip.className = "instructor-chip";
                    instructorChip.innerHTML = `<i class="fa-solid fa-user"></i> &nbsp; ${name}`;
                    instructorsList.appendChild(instructorChip);
                  });

                  instructorSection.appendChild(instructorLabel);
                  instructorSection.appendChild(instructorsList);

                  projectItem.appendChild(projectHeader);
                  projectItem.appendChild(projectTitle);
                  projectItem.appendChild(instructorSection);

                  projectsList.appendChild(projectItem);
                });

                backgroundUnSchedule.appendChild(projectsList);
                container.appendChild(backgroundUnSchedule);

              }

            })
            .catch(error => {
              console.error('Error fetching data:', error);
              document.getElementById("modalLoaderOverlay").style.display = "none";

              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong generate unschedule!",
              });
            });
  }



  // toggle program

  const selector = document.getElementById('program-selector');
  const selectedProgram = document.getElementById('program-text');
  const dropdownOptions = document.getElementById('dropdown-options');
  const options = document.querySelectorAll('.dropdown-option');

  selector.addEventListener('click', () => {

    let isVisible = dropdownOptions.style.display === "block";

    dropdownOptions.style.display = isVisible ? "none" : "block";

    selector.classList.toggle('active');
  })

  options.forEach(option => {

    option.addEventListener('click', (e) => {
      e.stopPropagation();

      const newValue = option.dataset.value;

      selectedProgram.textContent = newValue;

      selector.classList.remove('active');
      dropdownOptions.style.display = "none";

      getScheduleData();
      getUnScheduleData();

      console.log('Selected program:', newValue);

    });
  });

  document.addEventListener('click', (e) => {
    if(!selector.contains(e.target)) {

      selector.classList.remove('active');
      dropdownOptions.style.display = "none";
    }
  })

  // ====================================== click delete =====================================

  document.addEventListener('click', (e) => {
    const deleteButton = e.target.closest('.icon-delete');

    if(deleteButton) {

      const slotBox = deleteButton.closest('.slot-box');
      const id = slotBox.querySelector('#hiddenInfo');
      console.log("â—ï¸Do you want to delete project id " + id.value);

      Swal.fire({
        icon: "warning",
        title: "Are you sure ?",
        text: "Delete the schedule for project: " + id.value,
        showConfirmButton: true,
        confirmButtonColor: "#3085d6",
        confirmButtonText: "Delete",
        showCancelButton: true,
        cancelButtonText: "Cancel",
        cancelButtonColor: "#d33"
      }).then((result) => {

        if (result.isConfirmed) {
          deleteScheduleProject(id.value)
        }
      })

    }
  })

  function deleteScheduleProject(projectId) {

    fetch(`http://localhost:8080/admin/deleteProjectById?projectId=${encodeURIComponent(projectId)}`, {

      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    })
            .then(response => {
              // console.log(response.json());
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
                alert('Network response was not ok ' + response.statusText);
              }
              return response.json();
            })
            .then(data => {
              console.log("Deleted Project Status:", data);
              const statusDeleteProject = data.deleteProjectByIdStatus;
              console.log("deleteProjectByIdStatus:", statusDeleteProject);


              if (statusDeleteProject) {

                Swal.fire({
                  icon: "success",
                  title: "Delete schedule project successfully.",
                  showConfirmButton: false,
                  timer: 2000
                });

                getScheduleData();

              }
            })
            .catch(error => {
              console.error('Error fetching data:', error);

              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
              });
            });
  }
</script>

<!-- ----------- Set Header Value -------------- -->
<script>
  // à¸”à¸¶à¸‡à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¸ˆà¸²à¸ Dropdown (à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¹„à¸›à¸—à¸³à¸­à¸¢à¹ˆà¸²à¸‡à¸­à¸·à¹ˆà¸™à¹„à¸”à¹‰)
  const semesterSelect = document.getElementById("semester-selector");
  semesterSelect.addEventListener("change", function () {
    console.log("Selected Semester:", semesterSelect.value);

    localStorage.setItem("selectedSemester", semesterSelect.value);
    // fetchGradeDistribution();
    // fetchEvaluationStatus();
    // fetchTeacherScoringData();

    getScheduleData();
    getUnScheduleData();
  });

  // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² event listeners
  document.addEventListener("DOMContentLoaded", function () {
    // à¸­à¸±à¸›à¹€à¸”à¸• event listener à¸ªà¸³à¸«à¸£à¸±à¸š semester selector
    const semesterSelect = document.getElementById("semester-selector");
    semesterSelect.addEventListener("change", function () {
      console.log("Selected Semester:", semesterSelect.value);
    });
  });
</script>

<!-- --------- Semester Change ------------- -->
<script>


  async function fetchAcademicYears() {
    try {
      const response = await fetch('/api/academic-years'); // à¹€à¸£à¸µà¸¢à¸ API
      const data = await response.json();

      console.log("Year: ", data);

      const semesterSelector = document.getElementById('semester-selector');
      semesterSelector.innerHTML = ""; // à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸„à¹ˆà¸²à¸à¹ˆà¸­à¸™à¹€à¸•à¸´à¸¡à¹ƒà¸«à¸¡à¹ˆ

      data.forEach(year => {
        const option = document.createElement("option");
        option.value = year;
        option.textContent = "ðŸ“† "+year;
        // option.innerHTML = `<!--<i class='far fa-calendar'></i> ${year} <i class='fas fa-chevron-down dropdown-arrow'></i>-->`;
        semesterSelector.appendChild(option);
      });

      // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸”à¸·à¸­à¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
      const currentDate = new Date();
      const currentYear = currentDate.getFullYear();
      const currentMonth = currentDate.getMonth() + 1; // getMonth() à¸„à¸·à¸™à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ 0-11 (à¸¡à¸à¸£à¸²à¸„à¸¡ = 0, à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡ = 11)

      // à¸–à¹‰à¸²à¹€à¸”à¸·à¸­à¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ <= 6 (à¸¡.à¸„. - à¸¡à¸´.à¸¢.) à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸›à¸µà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ -1, à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™ à¸.à¸„. à¹€à¸›à¹‡à¸™à¸•à¹‰à¸™à¹„à¸›à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸›à¸µà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
      const defaultYear = currentMonth <= 8 ? currentYear - 1 : currentYear;

      // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸›à¸µà¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
      // if (data.includes(defaultYear.toString())) {
      //   semesterSelector.value = defaultYear.toString();
      //   console.log("yearrrrrrrrrrrrrr : ",document.getElementById('semester-selector').value)
      // } else {
      //   semesterSelector.selectedIndex = 0; // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸µà¸™à¸±à¹‰à¸™ à¹ƒà¸«à¹‰à¹€à¸¥à¸·à¸­à¸à¸•à¸±à¸§à¹à¸£à¸à¹à¸—à¸™
      // }

      const savedSemester = localStorage.getItem("selectedSemester");

      if (savedSemester && data.includes(savedSemester)) {
        semesterSelector.value = savedSemester;
      } else if (data.includes(defaultYear.toString())) {
        semesterSelector.value = defaultYear.toString();
      } else {
        semesterSelector.selectedIndex = 0;
      }


      await getScheduleData();
      await getUnScheduleData();

    } catch (error) {
      console.error("Error fetching academic years:", error);
    }
  }
  fetchAcademicYears();

  function deleteClickSchedule() {
    Swal.fire({
      icon: "warning",
      title: "Do you want to delete schedule",
      showConfirmButton: true,
      confirmButtonColor: "#3085d6",
      confirmButtonText: "Delete",
      showCancelButton: true,
      cancelButtonText: "Cancel",
      cancelButtonColor: "#d33"
    }).then((result) => {

      if (result.isConfirmed) {
        let program = document.getElementById("program-text").textContent;
        const semesterYear = document.getElementById("semester-selector").value;

        fetch(`http://localhost:8080/admin/deleteAllExitsSchedule?program=${encodeURIComponent(program)}&semesterYear=${encodeURIComponent(semesterYear)}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        })
                .then(response => response.json())
                .then(data => {
                  const statusDeleteAll = data.deleteStatus;
                  console.log("Schedule success delete:", statusDeleteAll);

                  if (statusDeleteAll) {
                    const schedule = document.querySelector(".schedule");
                    const container = document.querySelector(".container");
                    const table = document.querySelector("table");
                    schedule.innerHTML = "";
                    container.innerHTML = "";

                    Swal.fire({
                      icon: "success",
                      title: "Delete successfully.",
                      showConfirmButton: false,
                      timer: 2000
                    })

                    getScheduleData();
                  }
                })
                .catch(error => {
                  console.error('Error:', error);
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Failed to delete schedules!",
                  });
                });
      }
    });
  }


</script>


