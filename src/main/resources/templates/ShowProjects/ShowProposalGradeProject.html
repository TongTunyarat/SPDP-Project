<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proposal Grade Evaluation Project</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/css/sidebar-instructor.css">
  <link rel="stylesheet" href="/css/ShowProject.css">

  <!-- Library -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>

<body>
<div class="container">
  <!-- script à¹ƒà¸™à¸à¸²à¸£à¹€à¸›à¸´à¸”à¸›à¸´à¸” period -->
  <script>
    let accessPeriods = {};

    console.log('Calling updateLinkStatus function');
    window.onload = fetchAccessPeriods;
    setInterval(updateLinkStatus, 60000);

    async function fetchAccessPeriods() {
      try {
        const response = await fetch('http://localhost:8080/api/period'); // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ URL à¸•à¸²à¸¡ backend à¸‚à¸­à¸‡à¸„à¸¸à¸“
        if (!response.ok) {
          throw new Error('Failed to fetch access periods');
        }

        const data = await response.json(); // à¹à¸›à¸¥à¸‡ response à¹€à¸›à¹‡à¸™ JSON
        console.log(data);

        accessPeriods = convertApiResponseToObject(data); // à¹à¸›à¸¥à¸‡ array à¸ˆà¸²à¸ API à¹€à¸›à¹‡à¸™ object à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸‡à¹ˆà¸²à¸¢
        console.log("before set date: ", accessPeriods)
        updateLinkStatus(); // à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸²à¸™à¸°à¸‚à¸­à¸‡à¸¥à¸´à¸‡à¸à¹Œ
      } catch (error) {
        console.error('Error fetching access periods:', error);
      }
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹à¸›à¸¥à¸‡ API Response (Array) à¹€à¸›à¹‡à¸™ Object à¸•à¸²à¸¡ key à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹ƒà¸™ HTML
    function convertApiResponseToObject(data) {
      console.log("ðŸŽžï¸Convert api");
      console.log(data);

      // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² data à¹€à¸›à¹‡à¸™ array à¹à¸¥à¸°à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™ null à¸«à¸£à¸·à¸­ undefined
      if (!Array.isArray(data) || data.length === 0) {
        console.log("ðŸ’¡No data to process");
        return {}; // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™ array à¸ˆà¸°à¸„à¸·à¸™à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ object à¸§à¹ˆà¸²à¸‡à¹†
      }

      // 1ï¸âƒ£ à¸à¸³à¸«à¸™à¸”à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¸­à¸‡ Evaluation à¸—à¸µà¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š
      const allTypes = {
        "proposalEvaluation": "/show-proposal-eva-projects",
        "posterEvaluation": "/show-poster-projects",
        "defenseEvaluation": "/show-defense-eva-projects",
        "proposalGrade": "/show-proposal-grade-projects",
        "defenseGrade": "/show-defense-grade-projects"
      };

      let periodsObj = {};

      // 2ï¸âƒ£ à¸ªà¸£à¹‰à¸²à¸‡à¸„à¹ˆà¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸«à¹‰à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸ à¸— (isActive = false)
      Object.keys(allTypes).forEach(type => {
        periodsObj[type] = {
          start: null, // à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ null
          end: null,
          isActive: false, // à¸›à¸´à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
          path: allTypes[type],
          title: type
        };
      });

      // 3ï¸âƒ£ à¸­à¸±à¸›à¹€à¸”à¸•à¸„à¹ˆà¸²à¸–à¹‰à¸²à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ API
      data.forEach((period, index) => {
        console.log(`ðŸ’¡Processing item at index: ${index}`);

        let evaluationTypeKey;

        // à¹ƒà¸Šà¹‰ switch-case à¹€à¸žà¸·à¹ˆà¸­à¹à¸›à¸¥à¸‡ evaluationType à¹ƒà¸«à¹‰à¸•à¸£à¸‡à¸à¸±à¸šà¸„à¸µà¸¢à¹Œà¹ƒà¸™ allTypes
        switch (period.evaluationType) {
          case "Proposal Evaluation":
            evaluationTypeKey = "proposalEvaluation";
            break;
          case "Poster Evaluation":
            evaluationTypeKey = "posterEvaluation";
            break;
          case "Defense Evaluation":
            evaluationTypeKey = "defenseEvaluation";
            break;
          case "Proposal Grade":
            evaluationTypeKey = "proposalGrade";
            break;
          case "Defense Grade":
            evaluationTypeKey = "defenseGrade";
            break;
          default:
            console.log(`ðŸ’¡No matching key for evaluation type: ${period.evaluationType}`);
            return; // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸š case à¹ƒà¸”à¹† à¸à¹‡à¹ƒà¸«à¹‰à¸‚à¹‰à¸²à¸¡à¹„à¸›
        }

        console.log("ðŸ’¡Evaluation type key:", evaluationTypeKey);

        if (periodsObj.hasOwnProperty(evaluationTypeKey)) {
          // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸¥à¸°à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ à¸–à¹‰à¸²à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™ string à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸›à¸¥à¸‡à¹„à¸”à¹‰à¹€à¸›à¹‡à¸™à¸§à¸±à¸™à¸—à¸µà¹ˆ à¸ˆà¸°à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ null
          const startDate = Date.parse(period.startDate); // à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™ timestamp
          const endDate = Date.parse(period.endDate); // à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™ timestamp

          periodsObj[evaluationTypeKey] = {
            start: isNaN(startDate) ? null : new Date(startDate), // à¸–à¹‰à¸²à¹à¸›à¸¥à¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ null
            end: isNaN(endDate) ? null : new Date(endDate), // à¸–à¹‰à¸²à¹à¸›à¸¥à¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ null
            isActive: true, // à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ API -> à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
            path: allTypes[evaluationTypeKey],
            title: period.evaluationType
          };
        }
      });

      console.log("ðŸŽžï¸Final periodsObj: ", periodsObj); // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ
      return periodsObj;
    }

    function updateLinkStatus() {
      const currentTime = new Date(); // Get current time
      console.log("Current Time: ", currentTime); // Debugging line
      console.log("accessPeriods: ", accessPeriods)

      // Get all links with data-period
      const links = document.querySelectorAll('a[data-period]');
      console.log("links:", links); // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹„à¸”à¹‰à¸¥à¸´à¸‡à¸à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

      links.forEach(link => {
        const periodKey = link.getAttribute('data-period');
        const period = accessPeriods[periodKey];
        console.log("periodKey:", periodKey); // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² periodKey à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
        console.log("period: ",period)

        if (period) {
          const startTime = period.start ? new Date(period.start) : null;
          const endTime = period.end ? new Date(period.end) : null;

          console.log(`Checking link ${periodKey}:`, currentTime, startTime, endTime); // Debugging

          const isAccessible =
                  period.isActive &&
                  (startTime === null || currentTime >= startTime) &&
                  (endTime === null || currentTime <= endTime);

          console.log(`Is Accessible: ${isAccessible}`);


          if (!isAccessible) {
            link.classList.add('disabled-link'); // à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¹„à¸•à¸¥à¹Œ
            console.log('Disabled link added:', link);

            link.addEventListener('click', function (e) {
              e.preventDefault();

              let alertMessage = "ðŸš« This link is not accessible right now.";

              // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² startTime à¸«à¸£à¸·à¸­ endTime à¹€à¸›à¹‡à¸™ null à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
              if (startTime && endTime) {
                alertMessage += ` Available from ${startTime.toLocaleDateString()} to ${endTime.toLocaleDateString()}`;
              }

              console.warn(alertMessage); // à¹à¸ªà¸”à¸‡ warning à¹ƒà¸™ console
              alert(alertMessage); // à¹à¸ªà¸”à¸‡ alert à¸•à¸²à¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”
            });
          } else {
            link.classList.remove('disabled-link');

            // à¸¥à¸š event listener à¸—à¸µà¹ˆà¹€à¸„à¸¢à¹€à¸žà¸´à¹ˆà¸¡à¹„à¸§à¹‰ à¹€à¸žà¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰ alert à¸—à¸³à¸‡à¸²à¸™à¸–à¹‰à¸²à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¹€à¸›à¹‡à¸™ accessible
            link.replaceWith(link.cloneNode(true));
          }
        }
      });
    }
  </script>


  <div class="sidebar">
    <h2>ICT MAHIDOL</h2>
    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48"
               style="fill:#FFFFFF;">
        <path
                d="M39.5,43h-9c-1.381,0-2.5-1.119-2.5-2.5v-9c0-1.105-0.895-2-2-2h-4c-1.105,0-2,0.895-2,2v9c0,1.381-1.119,2.5-2.5,2.5h-9	C7.119,43,6,41.881,6,40.5V21.413c0-2.299,1.054-4.471,2.859-5.893L23.071,4.321c0.545-0.428,1.313-0.428,1.857,0L39.142,15.52	C40.947,16.942,42,19.113,42,21.411V40.5C42,41.881,40.881,43,39.5,43z">
        </path>
      </svg> Homepage </h4>
      <li><a href="/instructor/view">Dashboard</a></li>
    </ul>

    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">
        <g fill="#ffffff" fill-rule="nonzero">
          <g transform="scale(5.33333,5.33333)">
            <path
                    d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">
            </path>
          </g>
        </g>
      </svg> Evaluation (40%) </h4>
      <li><a href="/show-proposal-eva-projects" data-period="proposalEvaluation">Proposal Evaluation</a></li>
      <li><a href="/show-poster-projects" data-period="posterEvaluation">Poster Evaluation</a></li>
      <li><a href="/show-defense-eva-projects" data-period="defenseEvaluation">Defense Evaluation</a></li>
    </ul>

    <ul>
      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">
        <g fill="#ffffff" fill-rule="nonzero">
          <g transform="scale(5.33333,5.33333)">
            <path
                    d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">
            </path>
          </g>
        </g>
      </svg> Grades (60%) </h4>
      <li><a href="/show-proposal-grade-projects" data-period="proposalGrade">Proposal Grade</a></li>
      <li><a href="/show-defense-grade-projects" data-period="defenseGrade">Defense Grade</a></li>
    </ul>
  </div>
<!--  <div class="sidebar">-->
<!--    <h2>ICT MAHIDOL</h2>-->
<!--    <ul>-->
<!--      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48"-->
<!--               style="fill:#FFFFFF;">-->
<!--        <path-->
<!--                d="M39.5,43h-9c-1.381,0-2.5-1.119-2.5-2.5v-9c0-1.105-0.895-2-2-2h-4c-1.105,0-2,0.895-2,2v9c0,1.381-1.119,2.5-2.5,2.5h-9	C7.119,43,6,41.881,6,40.5V21.413c0-2.299,1.054-4.471,2.859-5.893L23.071,4.321c0.545-0.428,1.313-0.428,1.857,0L39.142,15.52	C40.947,16.942,42,19.113,42,21.411V40.5C42,41.881,40.881,43,39.5,43z">-->
<!--        </path>-->
<!--      </svg> Homepage </h4>-->
<!--      <li><a href="/instructor/view">Dashboard</a></li>-->
<!--    </ul>-->

<!--    <ul>-->
<!--      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">-->
<!--        <g fill="#ffffff" fill-rule="nonzero">-->
<!--          <g transform="scale(5.33333,5.33333)">-->
<!--            <path-->
<!--                    d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">-->
<!--            </path>-->
<!--          </g>-->
<!--        </g>-->
<!--      </svg> Evaluation (40%) </h4>-->
<!--      <li><a href="/show-proposal-eva-projects">Proposal Evaluation</a></li>-->
<!--      <li><a href="/show-poster-projects">Poster Evaluation</a></li>-->
<!--      <li><a href="/show-defense-eva-projects">Defense Evaluation</a></li>-->
<!--    </ul>-->

<!--    <ul>-->
<!--      <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0,0,256,256">-->
<!--        <g fill="#ffffff" fill-rule="nonzero">-->
<!--          <g transform="scale(5.33333,5.33333)">-->
<!--            <path-->
<!--                    d="M12.5,4c-2.481,0 -4.5,2.019 -4.5,4.5v31c0,2.481 2.019,4.5 4.5,4.5h23c2.481,0 4.5,-2.019 4.5,-4.5v-19.5h-11.5c-2.481,0 -4.5,-2.019 -4.5,-4.5v-11.5zM27,4.87891v10.62109c0,0.827 0.673,1.5 1.5,1.5h10.62109zM17.5,25h13c0.828,0 1.5,0.672 1.5,1.5c0,0.828 -0.672,1.5 -1.5,1.5h-13c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.828 0.672,-1.5 1.5,-1.5zM17.49023,32h8.99609c0.828,0 1.5,0.671 1.5,1.5c0.001,0.759 -0.56292,1.38733 -1.29492,1.48633l-0.20312,0.01367h-8.99609c-0.828,0 -1.5,-0.672 -1.5,-1.5c0,-0.759 0.56292,-1.38733 1.29492,-1.48633z">-->
<!--            </path>-->
<!--          </g>-->
<!--        </g>-->
<!--      </svg> Grades (60%) </h4>-->
<!--      <li><a href="/show-proposal-grade-projects">Proposal Grade</a></li>-->
<!--      <li><a href="/show-defense-grade-projects">Defense Grade</a></li>-->
<!--    </ul>-->
<!--  </div>-->

  <div class="content">

    <div class="header-section">
      Proposal Grade (60%)
    </div>

    <div class="table-container">
      <h1>Projects</h1>
      <div class="filter-controls">
        <label id="program-select"><strong>Program:</strong>
          <select id="program-select-box" name="program">
            <option value="all" selected>ALL</option>
            <option value="ict">ICT</option>
            <option value="dst">DST</option>
          </select>
        </label>
        <label id="role-select"><strong>Role:</strong>
          <select id="role-select-box" name="role">
            <option value="all" selected>ALL</option>
            <option value="advisor">Advisor</option>
            <option value="committee">Committee</option>
          </select>
        </label>
        <input id="search-keyword" type="text" placeholder="Search" />
      </div>

      <table id="result-table">
        <thead>
        <tr>
          <th>Project ID</th>
          <th>Project Name</th>
          <th>Role</th>
          <th>Student ID</th>
          <th>Student Names</th>
          <th>Evaluation</th>
          <th style="text-align: center">Grade Evaluation</th>
          <th>Grade</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="filter-results">
        <!-- Record Result -->

        </tbody>
      </table>
    </div>

  </div>

</div>
</body>

</html>

<script>

  function fetchData() {

    let url = 'http://localhost:8080/instructor/projectPropGradeList';

    fetch(url)
            .then(response => {
              // console.log(response.json());
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
              }
              return response.json();
            })
            .then(data => {
              console.log("Data: " + data);
              // à¹à¸ªà¸”à¸‡à¸œà¸¥à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸š
              displayResults(data);
            })
            .catch(error => {
              console.error('Error fetching data:', error);
              document.getElementById('filter-results').innerHTML = "à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥";
            });
  }

  document.addEventListener('DOMContentLoaded', function () {
    fetchData();
    // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² event listeners à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸•à¹ˆà¸¥à¸°à¸Ÿà¸´à¸¥à¸”à¹Œà¸Ÿà¸´à¸¥à¹€à¸•à¸­à¸£à¹Œ à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡
    document.getElementById('program-select-box').addEventListener('change', debounce(applyFilters, 100));
    document.getElementById('role-select-box').addEventListener('change', debounce(applyFilters, 100));
  });

  function debounce(func, delay) {
    let timeout;
    return function (...args) {
      // à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ timeout à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹€à¸”à¸´à¸¡à¸à¹ˆà¸­à¸™ à¹€à¸žà¸·à¹ˆà¸­à¸«à¸™à¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™
      clearTimeout(timeout);

      // à¸•à¸±à¹‰à¸‡ timeout à¹ƒà¸«à¸¡à¹ˆà¹€à¸žà¸·à¹ˆà¸­à¹€à¸£à¸µà¸¢à¸à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸”à¸µà¹€à¸¥à¸¢à¹Œà¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”
      timeout = setTimeout(() => func.apply(this, args), delay);
    };
  }

  // ------ Script for filter function ------- //
  function applyFilters() {
    const programFilter = document.getElementById('program-select-box')?.value;
    const roleFilter = document.getElementById('role-select-box')?.value;

    const rows = document.querySelectorAll("#filter-results tr");
    console.log(programFilter)
    console.log(roleFilter)

    rows.forEach(row => {
      const programCell = row.querySelector('.tag');
      const roleCell = row.querySelector('.role');

      let matches = true;

      // à¸à¸£à¸­à¸‡ Program: à¸–à¹‰à¸²à¹€à¸¥à¸·à¸­à¸ "All" à¸ˆà¸°à¹„à¸¡à¹ˆà¸à¸£à¸­à¸‡
      if (matches && programFilter !== 'all' && programCell) {
        matches = programCell.classList.contains(programFilter);
        console.log("Filtered Program : " + programFilter)
      }

      // à¸à¸£à¸­à¸‡ Role: à¸–à¹‰à¸²à¹€à¸¥à¸·à¸­à¸ "All" à¸ˆà¸°à¹„à¸¡à¹ˆà¸à¸£à¸­à¸‡
      if (matches && roleFilter !== 'all' && roleCell) {
        matches = roleCell.classList.contains(roleFilter);
        console.log("Filtered Role : " + roleFilter)
      }

      // à¹à¸ªà¸”à¸‡à¸«à¸£à¸·à¸­à¸‹à¹ˆà¸­à¸™à¹à¸–à¸§
      row.style.display = matches ? '' : 'none';
    });
  }


  // ------ Script for search function ------- //
  document.getElementById('search-keyword').addEventListener('input', function () {
    const searchTerm = this.value.toLowerCase();

    // à¸”à¸¶à¸‡à¸—à¸¸à¸à¹à¸–à¸§à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡à¸¡à¸²
    const rows = document.querySelectorAll("#filter-results tr");
    rows.forEach(row => {
      const cells = row.querySelectorAll('td');

      // à¸•à¸±à¸§à¹à¸›à¸£à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ check à¸§à¹ˆà¸² row à¸™à¸µà¹‰à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸„à¸³à¸„à¹‰à¸™à¸«à¸²à¸¡à¸±à¹‰à¸¢
      let rowMatches = false;

      // à¸§à¸™à¸¥à¸¹à¸›à¸œà¹ˆà¸²à¸™à¸—à¸¸à¸à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸™à¹à¸–à¸§
      cells.forEach(cell => {
        if (cell.textContent.toLowerCase().includes(searchTerm)) {
          rowMatches = true;
        }
      });

      // à¸–à¹‰à¸²à¹à¸–à¸§à¸™à¸µà¹‰à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸„à¸³à¸„à¹‰à¸™à¸«à¸²à¸à¹‡à¸ˆà¸°à¹à¸ªà¸”à¸‡à¹à¸–à¸§à¸™à¸±à¹‰à¸™
      if (rowMatches) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });

  function displayResults(data) {
    let tableBody = document.querySelector("tbody");
    tableBody.innerHTML = "";  // à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¹ˆà¸²


    try {
      data.forEach(project => {
        console.log("Process project: "+ project);

        const row = document.createElement('tr');

        // status
        const evaluationStatus = project.allEvaluationsComplete
                ? `<td>
                        <div class="status-icon completed">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                             <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                             <polyline points="22 4 12 14.01 9 11.01"></polyline>
                           </svg>
                        </div>
                         </td>`

                : `<td>
                        <div class="status-icon pending">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                             <circle cx="12" cy="12" r="10"></circle>
                             <polyline points="12 6 12 12 16 14"></polyline>
                           </svg>
                           </div>
                         </td>`;

        let maxInstructor = project.students[0].instructorEvaluation.totalInstructors;
        let completeEva = Math.min(...project.students.map(student => student.instructorEvaluation.completedInstructors));
        let waitEva = maxInstructor - completeEva;

        let completeEvaIcons = "";
        for (let i = 0; i < completeEva; i++) {
          completeEvaIcons += '<i class=\'fas fa-user-alt\' style=\'font-size:1.7rem;color:#78adc5\'></i>'
        }

        let waitEvaIcons = "";
        for (let i = 0; i < waitEva; i++) {
          waitEvaIcons += '<i class=\'fas fa-user-alt\' style=\'font-size:1.7rem;color:#dbdbdb\'></i>'
        }

        row.innerHTML = `
                 <td><span class="tag ${project.projectProgram.toLowerCase()}">${project.projectProgram}</span> ${project.projectId}</td>
                <td>${project.projectTitle}</td>
                <td><span class="role ${project.role.toLowerCase()}">${project.role}</span></td>
                <td>
                    <ul>
                        ${project.students.map(student => `<li>${student.studentId}</li>`).join('')}
                    </ul>
                </td>
                <td>
                    <ul>
                        ${project.students.map(student => `<li>${student.studentName}</li>`).join('')}
                    </ul>
                </td>
                <td>
                 ${completeEvaIcons}${waitEvaIcons}
                </td>
                ${evaluationStatus}
                <td>
                    <ul>
                        ${project.students.map(student => `<li>${student.gradeResult}</li>`).join('')}
                    </ul>
                </td>
                <td>
                    <form action="/instructor/editProposalGrade" method="get">
                        <input type="hidden" name="projectId" value="${project.projectId}">
                        <button type="submit"><span class="material-icons">edit</span></button>
                    </form>
                </td>
                `;
        tableBody.appendChild(row);
      })
    } catch (error) {
      console.error("Error display data in html: "+ error);
      document.getElementById('filter-results').innerHTML = "No valid data to display.";
    }
  }

</script>


